memo.ACTION={CONTENT_LIST:"CONTENT_LIST",LEFT_LIST:"LEFT_LIST"};memo.FILTER={IMPORTANT:"IMPORTANT",RECEIVED:"RECEIVED",PHOTO:"PHOTO",TODO:"TODO",DIARY:"DIARY",ALL:"ALL",FOLDER:"FOLDER",TRASH:"TRASH",SEARCH:"SEARCH",LINK:"LINK"};memo.FILTER_NAME={IMPORTANT:"중요 메모",RECEIVED:"받은 메모",PHOTO:"사진 첨부 메모",TODO:"할 일",DIARY:"다이어리",ALL:"전체 메모",FOLDER:"",TRASH:"휴지통",SEARCH:"검색 결과",LINK:"담은 링크"};memo.FILTER_ICON={IMPORTANT:"impt",RECEIVED:"receive",PHOTO:"pht",TODO:"todo",DIARY:"diary",ALL:"allview",FOLDER:"group",TRASH:"waste",SEARCH:"srch",LINK:"link"};memo.VIEW={MATRIX:"MATRIX",PIN:"PIN",EDITOR:"EDITOR"};memo.PHOTO_INFRA="https://phinf.pstatic.net/memo";memo.MESSAGE={CONNECT_FAIL:"일시적인 오류가 발생하였습니다.",LOGIN_FAIL:"로그인 정보가 변경되었습니다. 메모를 계속 사용하시려면, 다른 탭에서 동일한 계정으로 다시 로그인해주세요."};memo.TICKET_CANCEL={LAST:"LAST",CURRENT:"CURRENT"};memo.MAX_CONTENT_LENGTH=700000;memo.EDITOR={VERSION:{TEXT:0,RICH:1},IMAGE_TEMPLATE:"<img class='_memoInlineImage' src='#url#'>"};memo.utils={isIE:function(){var a=$Agent().navigator();if(a.ie){memo.utils.isIE=function(){return true}}else{memo.utils.isIE=function(){return false}}return memo.utils.isIE()},isIE8:function(){var a=$Agent().navigator();if(a.ie&&a.version<=8){memo.utils.isIE8=function(){return true}}else{memo.utils.isIE8=function(){return false}}return memo.utils.isIE8()},isLessThanOrEqualIE9:function(){var a=$Agent().navigator();if(a.ie&&a.version<=9){memo.utils.isLessThanOrEqualIE9=function(){return true}}else{memo.utils.isLessThanOrEqualIE9=function(){return false}}return memo.utils.isLessThanOrEqualIE9()},isEmpty:function(b){var a=!b;if(a){return true}if(b instanceof Array){return b.length===0}if(typeof b==="string"){var c=$S(b).trim().toString();return c.length===0||(c.length===1&&c.charCodeAt(0)===8203)}return a},isNotEmpty:function(a){return !memo.utils.isEmpty(a)},findParentByClass:function(d,a,c){var b=$Element(d);while(b!==null&&b.$value()!==document.body&&b.$value()!==c){if(b.hasClass(a)){break}b=b.parent()}return b?(b.$value()===document.body?null:b):null},formatRelativeTime:function(b){var c=Math.floor(b/1000),a=Math.floor($Date().time()/1000)-c;if(a<60){return"지금 막"}if(a<3600){return Math.floor(a/60)+"분 전"}if(a<86400){return Math.floor(a/3600)+"시간 전"}return $Date(b).format("Y.m.d H:i")},openNboardWindow:function(){var b="viewNboardList.nhn",a=620,c=563,h=window.screen.availHeight/2-a/2,g=window.screen.availWidth/2-c/2,f=window.open(b,"nBoardPopup","width="+c+",height="+a+",top="+h+", left="+g);try{f.focus()}catch(d){window.doNothing=d}},buildFilterParams:function(e,c){var b={},a=memo.utils.getSortOrder(),d=a.split("/");switch(e){case memo.FILTER.IMPORTANT:b.importantMemoYn="Y";break;case memo.FILTER.TRASH:b.deleteYn="Y";break;case memo.FILTER.SEARCH:b.searchText=c;break;case memo.FILTER.PHOTO:b.photoExistYn="Y";break;case memo.FILTER.TODO:b.todoYn="Y";break;case memo.FILTER.DIARY:b.memoShapeTypeCode="DIARY";break;case memo.FILTER.RECEIVED:b.receivedYn="Y";break;case memo.FILTER.LINK:b.linkYn="Y";break}b.orderByTarget=d[0];b.orderBy=d[1];return b},getSortOrder:function(){return $Cookie().get(memo.utils.getUserInfo().sUserId+"_sort_order")||"CREATE_DATE/DESC"},autoHeight:function(b,a,d,i,c,j){clearTimeout(memo.utils["_oEditorHeightTimeout_"+b]);var g=$Element(a),e=g.height(),h=g.$value().scrollHeight,f=0;if(e<h){g.height(h);if(memo.utils.isLessThanOrEqualIE9()&&i&&i!==window){i.$value().scrollTop=i.$value().scrollTop+parseInt(g.css("lineHeight"),10)}if(typeof j==="function"){j(h+e)}}else{if(!memo.utils.isIE8()){memo.utils["_oEditorHeightTimeout_"+b]=setTimeout($Fn(function(){var k=$Element(d),l;f=g.parent().width();if(f>0){k.parent().width()}g.parent().append(k.html(c));k.show();l=k.$value().scrollHeight;if(l!==e){g.height(l)}k.hide();if(typeof j==="function"){j(l-e)}},this).bind(),200)}}},focusAt:function(c,b){var a=$Element(c),d=a.text().length,f,e=document.activeElement;c=a.$value();if(c!==null&&d!==0){if(e&&e!==document&&e!==document.body){document.activeElement.blur()}if(c.selectionStart!==undefined){c.selectionStart=b;c.selectionEnd=b;c.focus()}else{if(c.createTextRange){f=c.createTextRange();f.moveStart("character",b);f.collapse();f.select()}}}else{c.focus()}},getSelection:function(e){var b=0,c=0,d,f,a;if(e.selectionStart!==undefined){b=e.selectionStart;c=e.selectionEnd}else{if(document.selection){d=document.selection.createRange();if(d!==null){f=e.createTextRange();a=f.duplicate();f.moveToBookmark(d.getBookmark());a.setEndPoint("EndToStart",f);b=a.text.length;c=b+d.text.length}}}return{nStart:b,nEnd:c}},clone:function(a){var b=null;if(memo.utils.isEmpty(a)){b=a}else{if(a instanceof Array){b=[];$A(a).forEach(function(c){b.push(memo.utils.clone(c))})}else{if(a instanceof Object){b={};$H(a).forEach(function(c,d){b[d]=memo.utils.clone(c)})}else{b=a}}}return b},setUserInfo:function(a){this._oUserInfo=a},getUserInfo:function(){return this._oUserInfo},convertTextToHtml:function(a){a=a.replace(/(?:\r\n|\r|\n)/g,"<br/>");a=a.replace(/(?:\t)/g,"&nbsp;&nbsp;&nbsp;&nbsp;");return a.replace(/(?:\s)/g,"&nbsp;")},isContentEmpty:function(b){if(typeof b==="string"){var a=$S(b).trim().toString();a=a.replace(/\u200B/g,"");return a.length===0||a=="<br>"||a=="<div><br></div>"||a=="<div></div>"}return true},hasLinkedParent:function(a){if(a.nodeName==="A"){return true}return a.parentNode?memo.utils.hasLinkedParent(a.parentNode):false},login:{goLoginPage:function(){window.location.href="https://nid.naver.com/nidlogin.login?mode=form&url="+memo.DOMAIN},callback:function(a){if(a===memo.utils.getUserInfo().sUserId){oMainUIController.reLoginSuccess()}else{alert("로그인 정보가 변경되었습니다.\n확인을 누르시면 페이지가 새로고침되어 변경된 정보를 확인하실 수 있습니다.");window.location.reload()}}},editor:{memoEditor:null,checkHasInvalidStyle:function(a){var b=/<[^>]*style[^>]*position\s*:\s*(fixed|absolute)[^>]*>/gi;return a&&b.test(a)},removeInvalidStyle:function(a){var b=/(<[^>]*style[^>]*)(position\s*:\s*(fixed|absolute);?)([^>]*>)/gi;return a.replace(b,"$1$4")},checkInputAndAttachLink:function(){var e=memo.utils.editor.memoEditor;if(!e){return false}var d=e.getSelection();if(!d||!d.isCollapsed){return false}var c=d.getRangeAt(0).cloneRange();var f=d.focusNode;var b=f.data;if(!b||memo.utils.hasLinkedParent(f)){return false}b=b.substring(0,c.endOffset);var a=Math.max(b.lastIndexOf(" "),b.lastIndexOf("\xa0"));if(a>=0){b=b.substring(a+1)}if(!(/^http[s]?:\/\/|^www\.|^m\./i.test(b))){return false}memo.utils.editor.attachLink(f,b,a,c.endOffset);return true},attachLink:function(f,a,e,c){var d=a;if(!(/^http[s]?:\/\//i.test(a))){d="http://"+a}if(e>=0){f=f.splitText(e+1);c=c-e}if(c<f.length){f.splitText(c)}var b=document.createElement("span");$j(b).text(a).wrapInner('<a href="'+d+'" target="_blank"></a>');f.parentNode.insertBefore(b,f);$j(f).remove()}}};memo.ajax={_nWorkingCallCount:0,_htTicket:{},_CACHE:{},call:function(e,f){var a=f.sTicket;var c=memo.ajax._htTicket[a];if(memo.utils.isNotEmpty(a)&&memo.utils.isNotEmpty(c)&&c.readyState!==0){if((f.sTicketCancel||memo.TICKET_CANCEL.LAST)===memo.TICKET_CANCEL.LAST){c.abort();memo.ajax._nWorkingCallCount--}else{return false}}if(f.bUsingCache===true){var d=memo.ajax._CACHE[e];if(memo.utils.isNotEmpty(d)&&typeof f.fCallback==="function"){f.fCallback(d);return true}}var b={method:"POST",traditional:true,data:f.oParams||{nothing:0}};var g=$j.ajax(e,b).done(function(h){memo.ajax._nWorkingCallCount--;if(h.code.toLowerCase()==="success"){if(f.bImportCache===true){memo.ajax._CACHE[e]=h.data}if(typeof f.fCallback==="function"){f.fCallback(h.data)}}else{memo.ajax._handleError(h,f.fErrorCallback)}}).fail(function(h){memo.ajax._nWorkingCallCount--;if(h.readyState===0||h.status===0){if(f.useErrorCallbackInCancel&&typeof f.fErrorCallback==="function"){f.fErrorCallback({})}return 0}memo.ajax._ajaxFail({},f.fErrorCallback,memo.MESSAGE.CONNECT_FAIL)});if(memo.utils.isNotEmpty(a)){memo.ajax._htTicket[a]=g}memo.ajax._nWorkingCallCount++;return true},_handleError:function(c,a){if(!c||!c.code){memo.ajax._ajaxFail(c,a,memo.MESSAGE.CONNECT_FAIL)}switch(c.code.toLowerCase()){case"login_fail":memo.utils.login.goLoginPage();break;case"readonly":if(c.message){alert(c.message)}memo.ajax._ajaxFail(c,a);break;case"fail":var b="";if(memo.utils.isNotEmpty(c.message)){b=c.message}else{b=memo.ajax._getErrorMessage(c.failType)}memo.ajax._ajaxFail(c,a,b);break;default:memo.ajax._ajaxFail(c,a,memo.MESSAGE.CONNECT_FAIL);break}},_ajaxFail:function(c,a,b){if(typeof a==="function"){if(a(c)===false){if(c){if(c.code.toLowerCase()==="login_fail"){return}alert(memo.ajax._getErrorMessage(c.failType))}}}else{if(memo.utils.isNotEmpty(b)){alert(b)}}},_getErrorMessage:function(a){var b="";switch(a){case"LOGIN_FAIL":b=memo.MESSAGE.LOGIN_FAIL;break;default:b=memo.MESSAGE.CONNECT_FAIL;break}return b}};memo.logger={log:function(a){if(console){console.log(a)}}};if(!memo){memo={}}memo.global={currentViewType:memo.VIEW.MATRIX,bInTrash:false};memo.nclicksHelper={findAreaCodeInToolbar:function(){if(memo.global.currentViewType==memo.VIEW.MATRIX){return"gdt"}else{if(memo.global.currentViewType==memo.VIEW.PIN){return"pnt"}else{return"met"}}},findAreaCodeInContent:function(){if(memo.global.currentViewType==memo.VIEW.MATRIX){return"gdv"}else{if(memo.global.currentViewType==memo.VIEW.PIN){return"pnv"}else{return"mem"}}}};if(!String.prototype.endsWith){String.prototype.endsWith=function(c,b){var a=this.toString();if(typeof b!=="number"||!isFinite(b)||Math.floor(b)!==b||b>a.length){b=a.length}b-=c.length;var d=a.indexOf(c,b);return d!==-1&&d===b}};memo.imageUploader=(function(){var a=$("uploadPhotoForm");var c=function(d){if(d!=="JPG"&&d!=="JPEG"&&d!=="GIF"&&d!=="PNG"){alert("지원하지 않는 파일 형식입니다. jpg, png, gif 파일을 올려 주세요.");return}a.target="uploadPhotoIframe";a.action="/memo/uploadPhoto.nhn";a.submit();a.target="";a.reset()};var b=function(d,h,g){var e=new FormData();var f=new XMLHttpRequest();f.open("post","/memo/uploadPhotoByXMLRequest.nhn",true);f.onreadystatechange=function(){if(f.readyState==4&&f.status==200){var i=JSON.parse(f.responseText);if(i.code!="SUCCESS"){alert(i.message);return}if(h=="chrome"||h=="imageCapture"||h=="wysiwyg"){g(i.photoUrl)}}};e.enctype="multipart/form-data";e.append("uploadPhoto",d,Date.now()+"."+d.type.split("/")[1]);f.send(e)};return{uploadImage:c,uploadImageFromClipboard:b}}());memo.MainUIController=$Class({$init:function(a){memo.utils.setUserInfo(a.oUserInfo);$c.mobileView=$Agent().navigator().mobile;this.option(a||{});this._defineElement();this._loadComponent();this._attachEvent();this._oHistory.initialize()},_defineElement:function(){this._welMemoDragLayer=$Element("memoDragLayer")},_attachEvent:function(){},_loadComponent:function(){this._oHistory=new jindo.AjaxHistory().attach({load:$Fn(function(c){this._initAction()},this).bind(),change:$Fn(function(d){var c=d.htHistoryData;if(memo.utils.isEmpty(c.sAction)){this._initAction();return}this._changeAction(c)},this).bind()});this._oLeftSideUIController=new memo.LeftSideUIController($("lside"),{sSkin:this.option("sSkin")}).attach({completeLoad:$Fn(function(c){this._completeLoad(c.htAction)},this).bind(),writeNewMemo:$Fn(function(){this._writeNewMemo()},this).bind(),deleteFolder:$Fn(function(d){var f,e=this._htAction,c=e.htParams;if(c.nFolderId===d.nFolderId){f=memo.utils.clone(c);f.sFilter=memo.FILTER.ALL;delete f.nMemoSeq;delete f.nFolderId;this._changeAction({sAction:e.sAction,htParams:f})}else{if(c.sFilter!==memo.FILTER.FOLDER){this._oContentUIController.reload()}}},this).bind(),emptyFolder:$Fn(function(d){var e=this._htAction,c=e.htParams;if(c.nFolderId===d.nFolderId||c.sFilter!==memo.FILTER.FOLDER){this._oContentUIController.reload()}},this).bind(),changeFilterInfo:$Fn(function(c){this._oContentUIController.changeFilterInfo(c.sName,c.nCount)},this).bind(),selectFilter:$Fn(function(c){this._changeAction({sAction:this._htAction?this._htAction.sAction:this._htLoadingAction.sAction,htParams:c.htParams})},this).bind(),selectMemo:$Fn(function(c){var d={sAction:memo.ACTION.LEFT_LIST,htParams:c.htParams};if(c.bReload===true){d.bReload=c.bReload}if(c.bAuto===true){this._oContentUIController.load(d)}else{this._changeAction(d)}},this).bind(),emptyMemo:$Fn(function(c){this._oContentUIController.showEmptyLayer()},this).bind(),renameFolder:$Fn(function(c){var d=this._htAction.htParams;if(d.sFilter===memo.FILTER.FOLDER&&d.nFolderId===c.nFolderId){this._oContentUIController.changeFilterInfo(c.sName)}},this).bind(),changeImportant:$Fn(function(c){this._oContentUIController.changeImportant(c.nMemoSeq,c.bImportant)},this).bind(),changeFolderColor:$Fn(function(c){this._oContentUIController.changeFolderColor(c.nFolderId,c.nColorId)},this).bind(),changeDefaultFolder:$Fn(function(c){this._oContentUIController.changeDefaultFolder(c.nFolderId,c.nColorId)},this).bind(),changePage:$Fn(function(c){var d=this._htAction;if(d.sAction===memo.ACTION.LEFT_LIST){this._changeAction({sAction:memo.ACTION.LEFT_LIST,htParams:c.htParams})}},this).bind(),completeLoad:$Fn(function(c){this._completeLoad(c.htAction)},this).bind()});this._oContentUIController=new memo.ContentUIController($("content")).attach({updatedMemo:$Fn(function(c){this._oLeftSideUIController.updatedMemo(c.nMemoSeq,c.sContent,c.bNew,c.bAffectedFilter)},this).bind(),deletedMemo:$Fn(function(c){this._oLeftSideUIController.nextMemo(c.nMemoSeq)},this).bind(),permanentDeletedMemo:$Fn(function(c){this._oLeftSideUIController.nextMemo(c.nMemoSeq)},this).bind(),emptyTrash:$Fn(function(c){this._changeAction({sAction:this._htAction.sAction,bReload:true,htParams:{sFilter:memo.FILTER.TRASH,nPage:1}});this._oLeftSideUIController.reload({bFilter:true,bFolder:false})},this).bind(),changeFolder:$Fn(function(c){var d=this._htAction.htParams.sFilter;if(d===memo.FILTER.FOLDER||d===memo.FILTER.TRASH){this._oLeftSideUIController.nextMemo(c.nMemoSeq)}},this).bind(),toggleFoldLeftSide:$Fn(function(){$Element("container").toggleClass("lft_fd")},this).bind(),changeAction:$Fn(function(c){this._changeAction(c.htData)},this).bind(),completeLoad:$Fn(function(c){this._completeLoad(c.htAction)},this).bind(),changeImportant:$Fn(function(c){this._oLeftSideUIController.changeImportant(c.nMemoSeq,c.bImportant)},this).bind(),writeNewMemo:$Fn(function(c){this._writeNewMemo()},this).bind(),change:$Fn(function(c){this._oLeftSideUIController.reload(c)},this).bind()});if(!$c.mobileView){var a=new jindo.DragArea($("content"),{sClassName:"_m_head",nThreshold:10}).attach({dragStart:$Fn(function(d){$Element(d.elHandle).query("._m_check").attr("checked",true);var f=this._oContentUIController.selectedMemos();var e=this._welMemoDragLayer;e.query("._count").text(f.length);var c=d.weEvent.pos();e.show().offset(c.pageY,c.pageX);d.elDrag=e.$value();$ElementList(f).addClass("dragging")},this).bind(),dragEnd:$Fn(function(c){this._welMemoDragLayer.hide();$ElementList(this._oContentUIController.selectedMemos()).removeClass("dragging")},this).bind()});var b=new jindo.DropArea($("lside"),{sClassName:"_memo_droppable",oDragInstance:a}).attach({over:function(c){$Element(c.elDrag).removeClass("ly_memo_notmove").addClass("ly_memo_move");$Element(c.elDrop).addClass("over")},out:function(c){$Element(c.elDrag).removeClass("ly_memo_move").addClass("ly_memo_notmove");$Element(c.elDrop).removeClass("over")},drop:$Fn(function(d){var e=$Element(d.elDrop);var c=e.data("id")*1;var g=e.data("filter");var f=this._oContentUIController.selectedMemoSeqs();if(g===memo.FILTER.FOLDER){this._changeFolder(f,c,e.data("name"))}else{if(g===memo.FILTER.TRASH){this._deleteMemos(f)}}},this).bind()})}this._oPromotionLayer=new memo.PromotionLayer($("promotionLayer"))},_writeNewMemo:function(){var b=this._htAction.htParams,a=memo.FILTER;this._changeAction({sAction:memo.ACTION.LEFT_LIST,bNew:true,htParams:{sFilter:b.sFilter===a.FOLDER?a.FOLDER:a.ALL,nFolderId:b.nFolderId}})},_changeFolder:function(c,b,a){memo.ajax.call("/memo/changeFolder.nhn",{oParams:{memoSeqs:c,folderId:b},fCallback:$Fn(function(){this._reload({bFilter:true});this._oContentUIController.showAlert(a+" 폴더로 이동하였습니다.")},this).bind()})},_deleteMemos:function(a){memo.ajax.call("/memo/deleteMemos.nhn",{oParams:{memoSeqs:a},fCallback:$Fn(function(){this._reload({bFilter:true});this._oContentUIController.showAlert(a.length+"개의 메모를 휴지통으로 이동했습니다.")},this).bind()})},_initAction:function(){var b=$Cookie().get(memo.utils.getUserInfo().sUserId+"_view_type")||memo.VIEW.MATRIX,a={bHistory:false,htParams:{sFilter:memo.FILTER.ALL,nPage:1}};switch(this.option("sInitAction")){case"VIEW":a.sAction=memo.ACTION.LEFT_LIST;a.bHideMemo=true;a.htParams.nMemoSeq=this.option("nMemoSeq");break;case"NEW":a.sAction=memo.ACTION.LEFT_LIST;a.bNew=true;break;case"TRASH":a.sAction=memo.ACTION.CONTENT_LIST;a.htParams.sFilter=memo.FILTER.TRASH;break;default:if(b===memo.VIEW.EDITOR){a.sAction=memo.ACTION.LEFT_LIST;a.bNew=true}else{a.sAction=memo.ACTION.CONTENT_LIST}break}this._changeAction(a)},_completeLoad:function(b){var a=this._htLoadingAction;if(b===a){this._htAction=a;$Element("wrap").$value().scrollTop=0;if(b.bHistory!==false){this._oHistory.addHistory(b)}}},_reload:function(a){this._oLeftSideUIController.reload(a);this._oContentUIController.reload()},_changeAction:function(a){this._htLoadingAction=a;this._oLeftSideUIController.load(a);if(a.sAction===memo.ACTION.CONTENT_LIST||a.htParams.nMemoSeq>0){this._oContentUIController.load(a)}this._oContentUIController.hideLayers()},uploadedPhoto:function(b,a){this._oContentUIController.uploadedPhoto(b,a)},reLoginSuccess:function(){this._oContentUIController.reLoginSuccess()},showAlert:function(b,a){this._oContentUIController.showAlert(b,a)}}).extend(jindo.Component);memo.LeftSideUIController=$Class({$init:function(b,a){this.option(a||{});this._loadComponent();this._attachEvent(b)},_loadComponent:function(){this._oFilterUIController=new memo.LeftSideFilterUIController($("lside")).attach({completeLoad:$Fn(function(){this._bFolderLoaded=true},this).bind(),select:$Fn(function(a){this.fireEvent("selectFilter",a)},this).bind(),rename:$Fn(function(a){this.fireEvent("renameFolder",a)},this).bind(),goList:$Fn(function(){this._oMemoUIController.hide()},this).bind(),changeColor:$Fn(function(a){this.fireEvent("changeFolderColor",a)},this).bind(),emptyFolder:$Fn(function(a){this.fireEvent("emptyFolder",a)},this).bind(),deleteFolder:$Fn(function(a){this.fireEvent("deleteFolder",a)},this).bind(),emptyMemo:$Fn(function(a){this.fireEvent("emptyMemo",a)},this).bind(),changeDefaultFolder:$Fn(function(a){this.fireEvent("changeDefaultFolder",a)},this).bind()});this._oMemoUIController=new memo.LeftSideMemoUIController($("leftSideMemo")).attach({completeLoad:$Fn(function(a){this._completeLoad(a.htParams);this._oFilterUIController.changeCount(a.nCount);this.fireEvent("changeFilterInfo",{sName:this._oFilterUIController.getSelectedName(),nCount:a.nCount})},this).bind(),select:$Fn(function(a){this.fireEvent("selectMemo",a)},this).bind(),empty:$Fn(function(a){this.fireEvent("emptyMemo",a);this._oFilterUIController.changeCount(0)},this).bind(),changeImportant:$Fn(function(a){if(a.bSelected){this.fireEvent("changeImportant",a)}this.reload({bFilter:true,bFolder:false})},this).bind(),changePage:$Fn(function(a){this.fireEvent("changePage",a)},this).bind()});this._oSkinLayer=new memo.SkinLayer({sSkin:this.option("sSkin")})},_attachEvent:function(b){var a=$Element(b);a.delegate("click","._write_btn",$Fn(function(c){c.stop();this.fireEvent("writeNewMemo")},this).bind());$Element("footer").delegate("click","._skin_btn",$Fn(function(c){c.stop();this._oSkinLayer.show(c.element)},this).bind());a.delegate("click","._left_bottom_banner",function(c){c.stop();var f=window.open("http://webmsg.naver.com/popup_send/send_url.php?code=memo&SMSID=ESW00017&MMSID=EMG00005","leftBottomBanner","toolbar=no,scrollbars=no ,width=285,height=402,top=100,left=100");try{f.focus()}catch(d){}})},_isChanged:function(b,d){if(memo.utils.isEmpty(b)){return true}var a=d.htParams,c=b.htParams;return d.sAction!==b.sAction||d.bReload===true||a.sFilter!==c.sFilter||a.nFolderId!==c.nFolderId||a.sSearchText!==c.sSearchText||a.nPage!==c.nPage},_loadFilters:function(a,c,b){if(this._bFolderLoaded===true){this._oFilterUIController.show(a,c,b)}else{this._oFilterUIController.load(a,c,b)}},_completeLoad:function(b){var a=this._htLoadingAction;if(a.htParams===b){this._htAction=a;if(a.sAction===memo.ACTION.LEFT_LIST){this._oMemoUIController.show(b.nMemoSeq||0,a.bNew)}this.fireEvent("completeLoad",{htAction:a})}},updatedMemo:function(a,c,b,d){this._oMemoUIController.updated(a,c,b);if(b){this._oFilterUIController.increaseCount()}if(d===true){this.reload({bFilter:true})}},nextMemo:function(a){this._oMemoUIController.nextMemo(a);this.reload({bFilter:true})},changeImportant:function(a,b){this._oMemoUIController.changeImportant(a,b)},reload:function(a){if(this._htAction.sAction===memo.ACTION.LEFT_LIST&&a.bMemo===true){this._oMemoUIController.reload()}this._oFilterUIController.reload(a)},load:function(c){var a=c.bHideMemo===true?memo.ACTION.CONTENT_LIST:c.sAction,e=c.htParams,d=e.sFilter,b=e.nFolderId;this._loadFilters(a,d,b);if(a===memo.ACTION.LEFT_LIST){this._htLoadingAction=c;if(this._isChanged(this._htAction,c)){this._oMemoUIController.load(e,c.bNew)}else{this._completeLoad(e)}}else{this._oMemoUIController.hide();this._htAction=c}},show:function(){},hide:function(){}}).extend(jindo.Component);memo.LeftSideFilterUIController=$Class({_TPL_COUNT:$Template('{if nCount > 0}<a href="#" class="num" style="background-color:transparent">{=nCount}</a>{/if}'),_TPL_FOLDER:$Template('<li class="_folder _filter _memo_droppable color{=nColorId}{if nFolderType==1} _default{/if}" data-filter="FOLDER" data-colorid="{=nColorId}" data-id="{=nFolderId}" data-name="{=sFolderName}" data-order="{=nOrder}" data-count="{=nCount}"><span class="ml_t"><span class="ico_mm group"></span><a href="#" class="ma" title="{=sFolderName}">{=sCuttedFolderName}{if nFolderType==1} (기본){/if}</a>&nbsp;{if nCount>0}<a href="#" class="num _count">{=nCount}</a>{/if}</span><a href="#" class="ico_mm folder_set _folder_config _btn_config" onclick="clickcr(this,\'lfl.edit\',\'\',\'\',event);"><span class="blind">폴더관리</span></a><span class="v_bar"></span></li>'),_TPL_FOLDER_EDITOR:$Template('<li class="color{=nColorId} new_folder _folder_edit" data-id="{=nFolderId}"><span class="ml_t"><span class="ico_mm group"></span><span class="set_inp"><label for="nameChange" class="blind">폴더 이름 변경</label><input type="text" value="{=sFolderName}" class="input_text _edit_text" maxLength="20"></span><span class="cfrm_fd"><a href="#" class="_edit_save" onclick="return false">확인</a><a href="#" class="_edit_cancel">취소</a></span></span><span class="ico_mm folder_set"></span><span class="v_bar"></span></li>'),$init:function(a){this._defineElement(a);this._attachEvent(a);this._loadComponent()},_defineElement:function(b){var a=this._welBody=$Element(b);this._htwFilter={IMPORTANT:a.query("._filter_impt"),PHOTO:a.query("._filter_photo"),TODO:a.query("._filter_todo"),DIARY:a.query("._filter_diary"),TRASH:a.query("._filter_trash"),LINK:a.query("._filter_link"),ALL:a.query("._filter_all")};this._welFolderList=a.query("._folder_list");this._welFolderDragLayer=$Element("folderDragLayer");this._welTrashArea=a.query("._trash_area");this._welFoldArea=a.query("._fold_area");this._welFoldHeader=a.query("._fold_header")},_attachEvent:function(c){var a=$Element(c);this._attachFolderEvent();a.query("._all_folder_area").delegate("click","._all_view_folders",$Fn(function(d){d.stop();this._welFoldArea.toggleClass("hide")},this).bind());a.query("._filter_trash").delegate("click","._empty_trash",$Fn(function(d){d.stop();if(confirm("휴지통을 비우면,\n지워진 메모(중요메모 포함)들은 복구할 수 없습니다.\n\n휴지통을 비우시겠습니까?")){memo.ajax.call("/folder/emptyTrashBox.nhn",{fCallback:$Fn(function(){this.reload({bFilter:true,bFolder:false});if(this._sFilter==memo.FILTER.TRASH){this.fireEvent("emptyMemo")}},this).bind()})}},this).bind());a.delegate("click","._filter",$Fn(function(f){f.stop();var d=$Element(f.element),e=d.data("id")*1;this.fireEvent("select",{htParams:{sFilter:d.data("filter"),nFolderId:e,nPage:1}});if(e>0){if(this._sAction===memo.ACTION.LEFT_LIST){clickcr(f.element,"lml.folderlist","","",f.pos())}else{clickcr(f.element,"lfl.myfolder","","",f.pos())}}},this).bind());var b=this._welFoldHeader;b.delegate("click","._fold_open",$Fn(function(d){d.stop();this._welFoldArea.query("._my_nav_list").toggleClass("open")},this).bind());b.delegate("click","._fold_go_list",$Fn(function(d){d.stop();this.show(memo.ACTION.CONTENT_LIST,this._sFilter,this._nFolderId);this.fireEvent("goList")},this).bind());$Element(document.body).attach("mousedown",$Fn(function(d){var e=this._welFoldArea.query("._my_nav_list");if(e.hasClass("open")&&memo.utils.findParentByClass(d.srcElement,"_folder_list")===null&&memo.utils.findParentByClass(d.srcElement,"_fold_open")===null){e.removeClass("open")}},this).bind())},_attachFolderEvent:function(){var a=this._welFolderList;this._welFoldArea.query("._all_folder_area").delegate("click","._new_folder",$Fn(function(b){b.stop();this._welFoldArea.removeClass("hide");this._showFolderEditor(0,this._findNewFolderName(),1)},this).bind());a.delegate("click","._folder_config",$Fn(function(c){c.stop();var d=c.element,b=memo.utils.findParentByClass(d,"_folder");this._oFolderConfigLayer.show(d,parseInt(b.data("id"),10),parseInt(b.data("colorid"),10),b.hasClass("_default"))},this).bind());a.delegate("contextmenu","._folder",$Fn(function(c){if(this._sAction===memo.ACTION.LEFT_LIST){return}c.stop();var b=$Element(c.element);this._oFolderConfigLayer.show(b.$value(),parseInt(b.data("id"),10),parseInt(b.data("colorid"),10),b.hasClass("_default"),true)},this).bind());a.delegate("mouseenter","._folder",function(b){$Element(b.element).addClass("over")});a.delegate("mouseleave","._folder",function(b){$Element(b.element).removeClass("over")});a.delegate("keydown","._edit_text",$Fn(function(b){if(b.key().enter){this._saveEdit(memo.utils.findParentByClass(b.element,"_folder_edit").$value())}else{if(b.key().esc){memo.utils.findParentByClass(b.element,"_folder_edit").addClass("_expired");this.load()}}},this).bind());a.delegate("mousedown","._edit_save",$Fn(function(b){b.stop();this._saveEdit(memo.utils.findParentByClass(b.element,"_folder_edit").$value())},this).bind());a.delegate("mousedown","._edit_cancel",$Fn(function(b){b.stop();this._cancelEditFolderName(memo.utils.findParentByClass(b.element,"_folder_edit"))},this).bind());a.delegate("focusout","._edit_text",$Fn(function(b){if(memo.utils.findParentByClass(b.element,"_folder_edit").hasClass("_expired")){return}this._saveEdit(memo.utils.findParentByClass(b.element,"_folder_edit").$value())},this).bind())},_loadComponent:function(){this._oFolderConfigLayer=new memo.FolderConfigLayer().attach({renameFolder:$Fn(function(d){var c=d.nFolderId,e=this._findFolderElement(c);this._showFolderEditor(c,$S(e.data("name")).escapeHTML().toString(),e.data("colorid"),e.$value());e.hide()},this).bind(),defaultFolder:$Fn(function(c){memo.ajax.call("/folder/modifyDefaultFolder.nhn",{oParams:{folderId:c.nFolderId},fCallback:$Fn(function(){this.load();this.fireEvent("changeDefaultFolder",{nFolderId:c.nFolderId,nColorId:c.nColorId})},this).bind()})},this).bind(),emptyFolder:$Fn(function(d){var c=d.nFolderId;if(confirm("'"+this._findFolderElement(c).data("name")+"' 폴더를 비우면,\n폴더에 있던 모든 메모(중요메모 포함)는 휴지통으로 이동합니다.\n\n폴더를 비우시겠습니까?")){memo.ajax.call("/folder/emptyFolder.nhn",{oParams:{folderId:c},fCallback:$Fn(function(){this.fireEvent("emptyFolder",{nFolderId:c});this.reload({bFilter:true})},this).bind()})}},this).bind(),deleteFolder:$Fn(function(d){var c=d.nFolderId;if(confirm("'"+this._findFolderElement(c).data("name")+"' 폴더를 삭제하면,\n폴더에 있던 모든 메모(중요메모 포함)는 휴지통으로 이동합니다.\n\n폴더를 삭제하시겠습니까?")){memo.ajax.call("/folder/deleteFolder.nhn",{oParams:{folderId:c},fCallback:$Fn(function(){this.fireEvent("deleteFolder",{nFolderId:c});this.reload({bFilter:true})},this).bind()})}},this).bind(),changeFolderColor:$Fn(function(d){var c=d.nFolderId,e=d.nColorId;memo.ajax.call("/folder/modifyFolderColor.nhn",{oParams:{folderId:d.nFolderId,colorId:e},fCallback:$Fn(function(){this.load();this.fireEvent("changeColor",{nFolderId:c,nColorId:e})},this).bind()})},this).bind()});if(!$c.mobileView){var b=new jindo.DragArea(this._welFolderList.$value(),{sClassName:"_folder",nThreshold:10}).attach({dragStart:$Fn(function(d){var f=this._welFolderDragLayer,c=d.weEvent.pos(),e=$Element(d.elDrag);f.show().offset(c.pageY,c.pageX).data("id",e.data("id")*1).query("._drag_name").text(e.data("name"));d.elDrag=f.$value()},this).bind(),dragEnd:$Fn(function(c){this._welFolderDragLayer.hide()},this).bind()});var a=new jindo.DropArea(this._welFolderList.$value(),{sClassName:"_folder",oDragInstance:b}).attach({move:function(d){var c=$Element(d.elDrop);if(Math.round(d.nRatioY*100)>50){c.removeClass("line_loc_top").addClass("line_loc")}else{c.removeClass("line_loc").addClass("line_loc_top")}},out:function(c){$Element(c.elDrop).removeClass("line_loc_top").removeClass("line_loc")},drop:$Fn(function(d){var e=$Element(d.elDrop),c=$Element(d.elDrag).data("id")*1,i=0,h=0,g,f;if(e.hasClass("line_loc_top")){g=e.prev();i=g.hasClass("_folder")?g.data("id")*1:-1;h=e.data("id")*1}else{i=e.data("id")*1;f=e.next();h=f?f.data("id")*1:-1}if(c===e.data("id")*1||c===i||c===h){$Element(d.elDrop).removeClass("line_loc_top").removeClass("line_loc");return}memo.ajax.call("/folder/moveFolderOrder.nhn",{oParams:{folderId:c,prevFolderId:i,nextFolderId:h},fCallback:$Fn(function(){this.reload({bFolder:true})},this).bind()})},this).bind()})}},_showFolderEditor:function(a,d,f,e){var c=$(this._TPL_FOLDER_EDITOR.process({nFolderId:a,nColorId:f,sFolderName:d})),b=$Element(c).query("._edit_text").$value();if(e){$Element(e).after(c)}else{this._welFolderList.append(c)}b.focus();b.select()},_findNewFolderName:function(){var a=[],b="";$A(this._welFolderList.child()).forEach(function(e){var d=e.data("name");if(/^내 메모 \([0-9]+\)$/.test(d)){a.push(/[0-9]+/.exec(d)[0]*1)}});a.sort(function(e,d){return e-d});for(var c=0;c<=100;c++){if(c+1>a.length||a[c]!==c){b="내 메모 ("+c+")";break}}return b},_saveEdit:function(d){var a=$Element(d),c=a.query("._edit_text").text(),b=a.data("id")*1,f=1000;a.addClass("_expired");if(memo.utils.isEmpty($S(c).trim().toString())){this.load();return}if(b*1===0){try{f+=a.prev().data("order")*1}catch(g){}var h=this;memo.ajax.call("/folder/createFolder.nhn",{oParams:{folderName:c,colorId:1,sortOrder:f,folderType:2},fCallback:$Fn(function(){this.reload({bFolder:true})},this).bind(),fErrorCallback:function(i){if(i&&i.message){alert(i.message)}var e=a.query("._edit_text").$value();if(i.failType==="FOLDER_MAX_COUNT"){h._cancelEditFolderName(memo.utils.findParentByClass(e,"_folder_edit"))}else{e.focus();e.select();setTimeout(function(){a.removeClass("_expired")},500)}}})}else{memo.ajax.call("/folder/modifyFolderName.nhn",{oParams:{folderId:b,folderName:c},fCallback:$Fn(function(){if(this._sFilter===memo.FILTER.FOLDER&&this._nFolderId===b){this.fireEvent("rename",{nFolderId:b,sName:c})}this.reload({bFolder:true})},this).bind(),fErrorCallback:function(i){if(i&&i.message){alert(i.message)}var e=a.query("._edit_text").$value();e.focus();e.select();setTimeout(function(){a.removeClass("_expired")},500)}})}},_findFolderElement:function(a){return this._welFolderList.query("> ._folder[data-id="+a+"]")},_select:function(i,g,e){var j=this._htwFilter,f=this._welFolderList,b=null,d=0,a=this._welFoldHeader,c=a.query("._fold_icon"),h=memo.FILTER_ICON[g];$H(j).forEach(function(k){k.removeClass("selected")});(f.query("._folder.selected")||f).removeClass("selected");if(g===memo.FILTER.FOLDER){b=f.query("._folder[data-id="+e+"]");d=b.data("colorid")*1}else{b=j[g]}if(b){b.addClass("selected")}if(i===memo.ACTION.LEFT_LIST){a.query("._fold_name").text(memo.FILTER_NAME[g]||b.data("name"));c.removeClass(c.data("icon")||"").removeClass("color"+c.data("colorid")).addClass(h).addClass("color"+d).data("icon",h).data("colorid",d)}},_applyFilterCount:function(a){a=a||{};$H(this._htwFilter).forEach(function(b,c){b.query("._count").html(this._TPL_COUNT.process({nCount:a[c.toLowerCase()]||0}))},this)},_loadFilterCount:function(){memo.ajax.call("/folder/filterCount.nhn",{fCallback:$Fn(function(a){this._applyFilterCount(a)},this).bind()})},_applyFolderUI:function(b){var f=this._welTrashArea,a=this._htwFilter[memo.FILTER.TRASH],d=this._welFoldHeader;if(a.parent()!==f){f.append(a)}var c=this._welFoldArea;c.removeClass("open");var e=this._htwFilter[memo.FILTER.ALL].parent();if(b===memo.ACTION.LEFT_LIST){this._welFolderList.append(a);c.addClass("list_view");this._welFolderList.prepend($Element("<li></li>").prepend(this._htwFilter[memo.FILTER.ALL]));this._welFoldArea.query("._my_nav_list").addClass("my_nav_list");this._welFoldArea.query("._all_folder_area").hide();d.show()}else{f.append(a);c.removeClass("list_view");this._welFoldArea.query("._all_folder_area").append(this._htwFilter[memo.FILTER.ALL]);this._welFoldArea.query("._my_nav_list").removeClass("my_nav_list");this._welFoldArea.query("._all_folder_area").show();d.hide()}if(e.test("li")){e.leave()}},_printFolders:function(b){var a=[];$A(b.folderList).forEach(function(c){a.push(this._TPL_FOLDER.process({nFolderId:c.folderId,nFolderType:c.folderType,nColorId:c.colorId,sFolderName:$S(c.folderName).escapeHTML().toString(),sCuttedFolderName:$S(c.cuttedFolderName).escapeHTML().toString(),nCount:c.memoCount,nOrder:c.sortOrder}))},this);this._welFolderList.html(a.join(""))},_loadFolders:function(a,c,b){memo.ajax.call("/folder/folderList.nhn",{bImportCache:true,fCallback:$Fn(function(d){this._printFolders(d,a);this.show(a,c,b)},this).bind()})},changeCount:function(a){this._welFoldHeader.query("._fold_count").text(a)},increaseCount:function(){var a=this._welFoldHeader.query("._fold_count");a.text((parseInt(a.text(),10)||0)+1)},getSelectedName:function(){var a=this._sFilter;if(a===memo.FILTER.FOLDER){return this._welFolderList.query("> ._folder.selected").data("name")}else{return memo.FILTER_NAME[a]}},_cancelEditFolderName:function(a){a.addClass("_expired").query("._edit_text").$value().blur();this.load()},reload:function(b){var a=this._sFilter;if(b.bFolder!==false){this._loadFolders(this._sAction,a,this._nFolderId)}if(b.bFilter!==false){this._loadFilterCount(a)}},load:function(a,c,b){this._loadFilterCount(c);this._loadFolders(a,c,b)},show:function(a,d,b){this._applyFolderUI(a);this._select(a,d,b);if(this._sAction!==a){var c=this._welBody.queryAll("._btn_config");if(a===memo.ACTION.LEFT_LIST){$ElementList(c).hide()}else{$ElementList(c).css("display","")}}this._sAction=a;this._sFilter=d;this._nFolderId=b;this.fireEvent("completeLoad")},hide:function(){}}).extend(jindo.Component);memo.LeftSideMemoUIController=$Class({_TPL_MEMO:$Template('<li class="_lsm" data-id="{=nMemoSeq}"><span class="ml_t"><span class="ico_mm solid"></span><a class="ma _lsm_content" href="#" onclick="clickcr(this,\'lml.memo\',\'\',\'\',event);">{if bUnreadReceiving == true}<span class="ico_new_rec _new_received_mark"><i class="blind">새로 받은 메모</i></span>{/if}{=sContent}</a></span><a href="#" class="ico_mm _lsm_impt impt{if bImportant} on{/if}" onclick="clickcr(this,\'lml.star\',\'\',\'\',event);"><span class="blind">중요메모로 표시</span></a></li>'),_LENGTH:20,$init:function(a){this._defineElement(a);this._loadComponent();this._attachEvent(a)},_defineElement:function(a){this._welBody=$Element(a);this._welEmpty=$Element("leftSideMemoEmpty")},_loadComponent:function(){this._oPagination=new jindo.Pagination($("leftSideMemoPagination"),{nPagePerPageList:5,sPageTemplate:"<a href=\"#\" onclick=\"clickcr(this,'lml.num','','',event);\">{=page}</a>",sCurrentPageTemplate:"<strong>{=page}</strong>",elPrevPageLinkOn:$('<a class="pre" href="#" onclick="clickcr(this,\'lml.prev\',\'\',\'\',event);"><span class="blind">이전</span></a>'),elNextPageLinkOn:$('<a class="next" href="#" onclick="clickcr(this,\'lml.next\',\'\',\'\',event);"><span class="blind">다음</span></a>'),elPrevPageLinkOff:$('<a class="pre dimmed" href="#"><span class="blind">이전</span></a>'),elNextPageLinkOff:$('<a class="next dimmed" href="#"><span class="blind">다음</span></a>')}).attach({click:$Fn(function(a){var b=memo.utils.clone(this._htParams);b.nPage=a.nPage;this.fireEvent("changePage",{htParams:b})},this).bind()})},_attachEvent:function(b){var a=$Element(b);a.delegate("click","._lsm_content",$Fn(function(d){d.stop();var c=memo.utils.findParentByClass(d.element,"_lsm"),e=null;if(!c.hasClass("selected")){e=memo.utils.clone(this._htParams);e.nPage=e.nPage||1;e.nMemoSeq=c.data("id")*1;this.fireEvent("select",{htParams:e})}},this).bind());a.delegate("click","._lsm_impt",$Fn(function(f){f.stop();var d=$Element(f.element),e=memo.utils.findParentByClass(d,"_lsm"),c=e.data("id")*1,g=d.toggleClass("on").hasClass("on");this.fireEvent("changeImportant",{nMemoSeq:c,bImportant:g,bSelected:e.hasClass("selected")});if(c>0){memo.ajax.call("/memo/changeImportant.nhn",{oParams:{memoSeq:c,important:g},fCallback:$Fn(function(){},this).bind()})}},this).bind())},_select:function(a){var b=this._welBody,d=b.query("> .selected"),c=b.query("> li[data-id="+a+"]");if(d){d.removeClass("selected")}if(c){c.addClass("selected");var e=c.query("._new_received_mark");if(e){e.leave()}}},_applyNewMemoUI:function(d,b){var a=this._welBody,c=this._TPL_MEMO.process({nMemoSeq:0,sContent:"새 메모",bImportant:false,bUnreadReceiving:false});if(this._htParams.nPage>1){a.append(c)}else{a.prepend(c)}this._select(0);this._welEmpty.hide();this.fireEvent("select",{bAuto:true,htParams:{sFilter:d,nFolderId:b,nMemoSeq:0}})},_printMemos:function(b){var a=[];$A(b.memoList).forEach(function(d){var c=d.memoPlainContent!=null?$S(d.memoPlainContent.substr(0,100)).escapeHTML().toString():$S(d.memoContent.substr(0,100)).escapeHTML().toString();if($S(c).trim().toString().length==0){c="메모"}a.push(this._TPL_MEMO.process({nMemoSeq:d.memoSeq,sContent:c,bImportant:d.important,bUnreadReceiving:d.receiving&&d.read==false}))},this);this._welBody.show().html(a.join(""))},_loadMemoList:function(f){var e=f.sFilter,c=f.nFolderId,a=f.nMemoSeq,b=memo.utils.buildFilterParams(e,f.sSearchText),d=b.sizePerPage=this._LENGTH;b.folderId=c||0;b.startIndex=((f.nPage||1)-1)*d;b.contentLength=200;b.excludeImage=true;memo.ajax.call("/memo/memoList.nhn",{sTicket:"MEMO_LIST",oParams:b,fCallback:$Fn(function(i){var g=i.totalCount,h=this._oPagination,j=$Element(h.getBaseElement());this._printMemos(i);this._welEmpty.hide();this.fireEvent("completeLoad",{htParams:f,nCount:g});this._changePageUI(g+(a>0?0:1),f.nPage,d)},this).bind()})},_changePageUI:function(a,c,d){var b=this._oPagination,e=$Element(this._oPagination.getBaseElement());if(a>d){b.setItemPerPage(d);b.setItemCount(a);b.movePageTo(c||1);e.show()}else{e.hide()}},_autoSelection:function(f){var b=this._welBody,c=f.nPage>1?b.last():b.first(),a=0,e,d=f.sFilter;if(c!==null){a=c.data("id")*1;this._select(a);e=memo.utils.clone(f);e.nMemoSeq=a;this.fireEvent("select",{bAuto:true,htParams:e})}else{if(d===memo.FILTER.FOLDER||d===memo.FILTER.ALL){this._applyNewMemoUI(d,f.nFolderId)}else{this._welEmpty.show();this.fireEvent("empty")}}},nextMemo:function(a){var c=this._welBody.query("> li[data-id="+a+"]"),e=memo.utils.clone(this._htParams),b=e.nPage,d=null;if(c&&c.hasClass("selected")){d=c.next()||c.prev();if(d===null){if(b>1){e.nPage=Math.max(b-1,1);delete e.nMemoSeq;this.fireEvent("changePage",{htParams:e})}else{c.leave();this._welEmpty.show();this.fireEvent("empty")}}else{e.nMemoSeq=d.data("id")*1;e.nPage=b;this.fireEvent("select",{bReload:true,htParams:e})}}},changeImportant:function(a,c){var b=this._welBody.query("> li[data-id="+a+"]");if(b!==null){b.query("._lsm_impt").cssClass({on:c})}},updated:function(a,d,c){var e=c?0:a;var b=this._welBody.query("> li[data-id="+e+"]");if(b!=null){b.data("id",a);b.query("._lsm_content").text(d)}},reload:function(){this.load(this._htParams)},load:function(b,a){this._htParams=b;if(a===true&&memo.utils.getSortOrder().split("/")[1]==="ASC"){memo.ajax.call("/memo/selectTotalCount.nhn",{oParams:{folderId:b.nFolderId||0},fCallback:$Fn(function(c){b.nPage=Math.ceil((c+1)/this._LENGTH);this._loadMemoList(b)},this).bind()})}else{this._loadMemoList(b)}},show:function(a,c){var b=this._welBody.query("> li[data-id=0]"),d=this._htParams;if(b){b.leave()}if(a>0){this._select(a,true)}else{if(c===true){this._applyNewMemoUI(d.sFilter,d.nFolderId)}else{this._autoSelection(d)}}this._welBody.show()},hide:function(){this._welBody.hide();this._welEmpty.hide();$Element(this._oPagination.getBaseElement()).hide()}}).extend(jindo.Component);memo.ContentUIController=$Class({ACTION:{CONTENT_LIST:{sName:memo.ACTION.CONTENT_LIST,oController:null},LEFT_LIST:{sName:memo.ACTION.LEFT_LIST,oController:null}},$init:function(b){this._defineElement(b);this._loadComponent(b);this._attachEvent(b);this._changeSelectedViewTypeUI($Cookie().get(memo.utils.getUserInfo().sUserId+"_view_type")||memo.VIEW.MATRIX);var a=memo.utils.getSortOrder(),c=a.split("/");this._changeSortOrder(c[0],c[1],true)},_defineElement:function(c){var a=$Element(c);var b=this._welHeader=a.query("> ._ct_header");var d=this._welFunc=a.query("> ._ct_func");this._welFilterInfo=b.query("._filter_info");this._welCheckedMessage=b.query("._checked_message");this._welAlert=b.query("._alert");this._welSearchText=b.query("._search_text");this._welLayout=d.query("._ct_layout");this._welSortOrder=d.query("._sort_order");this._welRefresh=b.query("._ct_refresh");this._welGoList=b.query("._go_list");this._welEmptyMemo=$Element("emptyMemo");this._welEmptySearch=$Element("emptySearch");this._welContentBody=a.query("._memo_content")},_loadComponent:function(a){this._oContentEditor=new memo.ContentEditor();this._oFunctionBarController=new memo.FunctionBarController($j("._ct_func"));this.ACTION.CONTENT_LIST.oController=this._oContentListUIController=new memo.ContentListUIController($Element(a).query("._ct_list_area").$value(),this._oContentEditor).attach({updated:$Fn(function(b){if(!b.bHistoryAdded){this._oFunctionBarController.updateHistory(b.oMemo)}},this).bind(),startHistory:$Fn(function(b){this._oFunctionBarController.startHistory(b.oMemo)},this).bind(),showHistoryLayer:$Fn(function(b){this._oFunctionBarController.showHistoryLayer(b.oMemo)},this).bind(),completeLoad:$Fn(function(b){this._completeLoad(b.htParams,b.bEmpty)},this).bind(),changeFilterInfo:$Fn(function(b){this.changeFilterInfo(b.sName,b.nCount)},this).bind(),checked:$Fn(function(b){var c=this._welCheckedMessage;if(b.nCount>0){c.query("._count").text(b.nCount);c.show("inline-block")}else{c.hide()}},this).bind(),change:$Fn(function(b){this.fireEvent("change",b)},this).bind(),alert:$Fn(function(b){this.showAlert(b.sMessage,b.skipAutoHide)},this).bind(),changeAction:$Fn(function(b){this.fireEvent("changeAction",b)},this).bind(),writeNewMemo:$Fn(function(b){this.fireEvent("writeNewMemo",b)},this).bind(),showHideFunctionButton:$Fn(function(c){var b=c.sButtonShowType;this._oFunctionBarController.showHideButton(b)},this).bind(),enableFunctionButton:$Fn(function(c){var b=c.bEnable;this._oFunctionBarController.enableFunctionButton(b)},this).bind()});this._oSortOrderLayer=new memo.SortOrderLayer().attach({select:$Fn(function(b){this._changeSortOrder(b.sTarget,b.sDirection)},this).bind()});this.ACTION.LEFT_LIST.oController=this._oContentEditorUIController=new memo.ContentEditorUIController($("memoEditor"),this._oContentEditor).attach({updated:$Fn(function(b){if(b.bNew){this._increaseCount()}this.fireEvent("updatedMemo",b);if(!b.bHistoryAdded){this._oFunctionBarController.updateHistory(b.oMemo)}},this).bind(),startHistory:$Fn(function(b){this._oFunctionBarController.startHistory(b.oMemo)},this).bind(),showHistoryLayer:$Fn(function(b){this._oFunctionBarController.showHistoryLayer(b.oMemo)},this).bind(),applyDiff:$Fn(function(){this._oContentEditorUIController.applyDiff(this._oFunctionBarController.getSelectedDiffMemo())},this).bind(),change:$Fn(function(b){this.fireEvent("change",b)},this).bind(),changeImportant:$Fn(function(b){this.fireEvent("changeImportant",b)},this).bind(),deleted:$Fn(function(b){this.fireEvent("deletedMemo",b)},this).bind(),permanentDeleted:$Fn(function(b){this.fireEvent("permanentDeletedMemo",b)},this).bind(),emptyTrash:$Fn(function(b){this.fireEvent("emptyTrash",b)},this).bind(),changeFolder:$Fn(function(b){this.fireEvent("changeFolder",b)},this).bind(),writeNewMemo:$Fn(function(b){this.fireEvent("writeNewMemo",b)},this).bind(),completeLoad:$Fn(function(b){this._completeLoad(b.htParams)},this).bind(),showHideFunctionButton:$Fn(function(c){var b=c.sButtonShowType;this._oFunctionBarController.showHideButton(b)},this).bind(),enableFunctionButton:$Fn(function(c){var b=c.bEnable;this._oFunctionBarController.enableFunctionButton(b)},this).bind(),alert:$Fn(function(b){this.showAlert(b.sMessage,b.skipAutoHide)},this).bind()});this._oFunctionBarController.setDependObject({contentUIController:this,contentListUIController:this._oContentListUIController,contentEditorUIController:this._oContentEditorUIController});this._oAudioPlayer=new memo.AudioPlayer()},_attachEvent:function(c){var b=this._welHeader;var d=this._welFunc;b.delegate("click","._ct_go_list",$Fn(function(e){e.stop();this.goToListView()},this).bind());b.delegate("click","._toggle_fold_lside",$Fn(function(e){e.stop();this.fireEvent("toggleFoldLeftSide")},this).bind());this._welSortOrder.attach("click",$Fn(function(e){e.stop();this._oSortOrderLayer.show(e.element)},this).bind());b.delegate("click","._ct_refresh",$Fn(function(e){e.stop();if(this._htAction.sAction===memo.ACTION.CONTENT_LIST){this._oContentListUIController.reload()}},this).bind());d.delegate("click","._ct_view",$Fn(function(e){e.stop();if($Element(e.element).hasClass("on")){return}var h=$Element(e.element).data("view"),f=this._htAction,g=memo.utils.clone(f.htParams);if(h===memo.VIEW.EDITOR){g.nPage=1;this.fireEvent("changeAction",{htData:{sAction:memo.ACTION.LEFT_LIST,htParams:g}})}else{if(f.sAction===memo.ACTION.LEFT_LIST){this.fireEvent("changeAction",{htData:{sAction:memo.ACTION.CONTENT_LIST,htParams:g}})}this._oContentListUIController.changeViewType(h)}$Cookie().set(memo.utils.getUserInfo().sUserId+"_view_type",h);this._changeSelectedViewTypeUI(h)},this).bind());b.delegate("click","._alert_close",$Fn(function(e){e.stop();this._welAlert.hide()},this).bind());var a=this._welSearchText;a.attach("focus",function(f){var e=$Element(f.element);if(e.hasClass("write_ipt")){e.text("").removeClass("write_ipt")}});a.attach("blur",function(f){var e=$Element(f.element);if(memo.utils.isEmpty(e.text())){e.addClass("write_ipt").text(e.data("default"))}});a.attach("keydown",$Fn(function(e){if(e.key().enter){e.stop();this._search()}},this).bind());b.delegate("click","._search_btn",$Fn(function(e){e.stop();this._search()},this).bind());this._welEmptySearch.delegate("click","._ct_back",function(e){e.stop();window.history.back()});this._welEmptyMemo.delegate("click","._empty_new_memo",$Fn(function(e){e.stop();this.fireEvent("writeNewMemo",{htData:{htAction:memo.ACTION.LEFT_LIST,htParams:{sFilter:memo.FILTER.ALL}}})},this).bind())},_changeSortOrder:function(a,b,d){var g=a+"/"+b,c=memo.utils.getUserInfo().sUserId+"_sort_order";this._welSortOrder.query("._sort_order_info").text((a==="UPDATE_DATE"?"수정일":"생성일")+" ("+(b==="DESC"?"최신순":"오래된순")+")");if(g===$Cookie().get(c)){return}$Cookie().set(c,g,365);if(d!==true){var e=this._htAction;if(e){if(e.sAction===memo.ACTION.CONTENT_LIST){this.reload()}else{var f=memo.utils.clone(e.htParams);f.nPage=1;delete f.nMemoSeq;this.fireEvent("changeAction",{htData:{sAction:memo.ACTION.LEFT_LIST,bReload:true,htParams:f}})}}}},_changeSelectedViewTypeUI:function(c){var b=this._welLayout;var a=b.query("._ct_view .on");if(a){a.removeClass("on")}b.query("._ct_view[data-view="+c+"]").first().addClass("on");memo.global.currentViewType=c},_search:function(){var b=this._welSearchText,a=b.text();if(memo.utils.isNotEmpty(a)&&!b.hasClass("write_ipt")){this.fireEvent("changeAction",{htData:{sAction:memo.ACTION.CONTENT_LIST,htParams:{sFilter:memo.FILTER.SEARCH,sSearchText:a}}})}else{alert("검색어를 입력하세요.");b.$value().focus()}},_completeLoad:function(g,a){var c=this._htLoadingAction,e=c.htParams;if(g===e){if(this._htAction){var b=this.ACTION[this._htAction.sAction];if(b){b.oController.hide()}}var f=e.sFilter;if(a===true&&f!==memo.FILTER.FOLDER&&f!==memo.FILTER.ALL){this.showEmptyLayer(f)}else{this.ACTION[c.sAction].oController.show()}this._htAction=c;var d=this._welSearchText;if(e.sFilter===memo.FILTER.SEARCH){d.text(e.sSearchText).removeClass("write_ipt")}else{d.text(d.data("default")).addClass("write_ipt")}if(c.sAction===memo.ACTION.LEFT_LIST){this._welGoList.show();this._welRefresh.hide()}else{this._welGoList.hide();this._welRefresh.show("inline-block")}this.fireEvent("completeLoad",{htAction:c})}},_hideEmptyLayer:function(){this._welEmptyMemo.hide();this._welEmptySearch.hide()},uploadedPhoto:function(b,a){this._oContentEditorUIController.uploadedPhoto(b,a)},showEmptyLayer:function(a){this._hideEmptyLayer();this.ACTION[memo.ACTION.CONTENT_LIST].oController.hide();this.ACTION[memo.ACTION.LEFT_LIST].oController.hide();if(a===memo.FILTER.SEARCH){this._welEmptySearch.show()}else{this._welEmptyMemo.show()}this.changeFilterInfo(null,0);this._welGoList.hide();this._oContentEditorUIController.viewWhenEmptyMemo()},showAlert:function(a,b){clearTimeout(this._oAlertTimeout);var c=this._welAlert;if(a){c.query("._alert_message").text(a);c.show();if(!b){this._oAlertTimeout=setTimeout($Fn(function(){c.hide()},this).bind(),5000)}}else{c.hide()}},changeImportant:function(a,b){if(this._htAction.sAction===memo.ACTION.LEFT_LIST){this.ACTION.LEFT_LIST.oController.changeImportant(a,b)}},changeFolderColor:function(a,b){this.ACTION[this._htAction.sAction].oController.changeFolderColor(a,b)},_increaseCount:function(){var b=this._welFilterInfo,a=b.query("._count");a.text((parseInt(a.text(),10)||0)+1);b.show()},changeFilterInfo:function(c,a){var b=this._welFilterInfo;if(memo.utils.isNotEmpty(c)){b.query("._name").text(c)}if(a===0||a>0){b.query("._count").text(a)}b.show()},selectedMemos:function(){return this._oContentListUIController.selectedMemos()},selectedMemoSeqs:function(){return this._oContentListUIController.selectedMemoSeqs()},changeDefaultFolder:function(a,b){this._oContentListUIController.changeDefaultFolder(a,b)},goToListView:function(){var a=memo.utils.clone(this._htAction.htParams);this.fireEvent("changeAction",{htData:{sAction:memo.ACTION.CONTENT_LIST,htParams:a}})},reload:function(){this._hideEmptyLayer();this.ACTION[this._htAction.sAction].oController.reload()},load:function(b){this._changeSelectedViewTypeUI(b.sAction===memo.ACTION.LEFT_LIST?memo.VIEW.EDITOR:this._oContentListUIController.getViewType());this._welCheckedMessage.hide();this._hideEmptyLayer();this._htLoadingAction=b;this.ACTION[memo.ACTION.LEFT_LIST].oController.stopAutoSave();var a=b.sAction,c=b.htParams;if(c.bEmpty){this.showEmptyLayer();this._completeLoad(c)}else{this.ACTION[a].oController.load(c)}this._welContentBody.$value().scrollTop=0},hideLayers:function(){this._oFunctionBarController.hideLayers();this._oContentEditorUIController.hideLayers();this._oSortOrderLayer.hide()},reLoginSuccess:function(){if(this._htAction.sAction===memo.ACTION.LEFT_LIST){this._oContentEditorUIController.resumeAutoSave()}}}).extend(jindo.Component);memo.ContentListUIController=$Class({_CONTENT_LENGTH:1000,_MEMO_WIDTH:274,_DEFAULT_LENGTH:41,_DEFAULT_MORE_LENGTH:24,_TPL_MEMO:$Template('<div class="wrap_paper color{=nDisplayColorId} _ct_memo{if bDiary} diary{/if} {if sLinkUrl} link_og {/if}" data-id="{=nMemoSeq}" data-index="{=nIndex}" data-folderid="{=nFolderId}" data-colorid="{=nMemoColorId}"><div class="paper_area"><div class="memo_head _m_head"><div class="mm_check _m_check_area"><label for="chk_memo" class="blind">메모 내용<span class="blind">메모 선택</span></label><input id="m_chk_{=nMemoSeq}" name="m_chk_{=nMemoSeq}" type="checkbox" class="_m_check"><p class="update_time _update_time"><span class="blind">작성 시간 : </span>{=sDate}</p><p class="update_time _timer_message" style="display: none;"></p><div class="edit_area"><a href="#" class="fullview _m_wide"><span class="ico"><span class="blind">크게 보기에서 수정하기</span></span></a>{if !bDeleted}<a href="#" class="modify _m_edit"><span class="ico"><span class="blind">수정하기</span></span></a><a href="#" class="important _m_impt {if bImportant} active{/if}"><span class="ico"><span class="blind">중요 표시하기</span></span></a>{/if}</div></div></div><div class="memo_area _m_area"><div class="memo_inner workseditor _m_view">{=sContent}</div></div>{if sLinkUrl}<div class="memo_og"><div class="mm_scrap"><span class="blind">담은링크 :</span><div class="scrap_box"><span class="thmb" {if !sThumbnailUrl}style="display:none"{/if}><img src="{=sThumbnailUrl}" alt="썸네일"></span><a href="{=sLinkUrl}" target="_blank" title="링크 바로가기"><span class="wrap_cont"><strong>{=sLinkDisplayText}</strong><span class="cont">{=sLinkDesc}</span><span class="link_url">{=sLinkUrl}</span></span></a></div></div></div>{/if}</div></div>'),URL_REGEX:/(https?:\/\/|www\.|m\.)([a-zA-Z0-9][\.a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,})(:(\d)+)?(\/[-a-zA-Z0-9+&@#\/%?=~_|$!:,.;]*[-a-zA-Z0-9+&@#\/%=~_|$])*/gi,$init:function(b,a){this._oContentEditor=a;this._sViewType=$Cookie().get(memo.utils.getUserInfo().sUserId+"_view_type")||memo.VIEW.MATRIX;this._defineElement(b);this._loadComponent(b);this._attachEvent(b)},_defineElement:function(b){var a=this._welBody=$Element(b);this._welList=a.query("._ct_list");this._welFunc=$Element("content").query("._ct_func");this._welMore=a.query("._ct_more_bar");this._welScrollTarget=a.parent();this._welButtonMove=this._welScrollTarget.query("._btn_move")},_loadComponent:function(b){this._oNewMemo=new memo.ContentListNewMemo($Element(b).query("._ct_new_memo").$value(),this._sViewType,this._oContentEditor).attach({startHistory:$Fn(function(){this.fireEvent("startHistory",{oMemo:{}})},this).bind(),write:$Fn(function(){this.reload();this.fireEvent("change",{bFilter:true,bFolder:true})},this).bind(),writeNewMemo:$Fn(function(){this.fireEvent("writeNewMemo")},this).bind(),wide:$Fn(function(c){this._goWideMode(c.nMemoSeq,memo.utils.getSortOrder().split("/")[1]==="DESC"?1:this._nTotalCount+1)},this).bind(),clearAllCheckbox:$Fn(function(){this._clearAllCheckbox()},this).bind(),disableAllCheckbox:$Fn(function(){this._disableAllCheckbox()},this).bind(),alert:$Fn(function(c){this.fireEvent("alert",c)},this).bind()});this._oPhotoViewer=new memo.PhotoViewer();this._oFolderSelectionLayer=new memo.FolderSelectionLayer().attach({select:$Fn(function(c){if(this._oContentEditor.isShown()){if(memo.utils.isContentEmpty(this._oContentEditor.getEditorContent())){this._oContentEditor.setContent("<br><br>")}this._saveMemo($Fn(function(){this.stopAutoSave()},this).bind())}memo.ajax.call("/memo/changeFolder.nhn",{oParams:{memoSeqs:this.selectedMemoSeqs(),folderId:c.nFolderId},fCallback:$Fn(function(){this.reload();this.fireEvent("change",{bFolder:true});this.fireEvent("alert",{sMessage:c.sFolderName+" 폴더로 이동하였습니다."})},this).bind()})},this).bind()});this._oMemoSendLayer=memo.MemoSendLayer.prototype.getInstance();this._oColorLayer=new memo.ColorLayer().attach({select:$Fn(function(c){if(memo.global.currentViewType!=memo.VIEW.MATRIX&&memo.global.currentViewType!=memo.VIEW.PIN){return}this._changeColor(c.nColorId);this._oContentEditor.focus()},this).bind()});this._htFolderColorMap={};var a=new jindo.Timer();this._oAutoSaveTimer=a;a.start($Fn(function(){this._saveMemo(null,true);return true},this).bind(),5000);a.pause()},_attachEvent:function(b){this._attachListEvent();var a=$Element(b);var c=this;$Element(window).attach("resize",$Fn(function(){clearTimeout(this._oRearrangePinViewTimeout);this._oRearrangePinViewTimeout=setTimeout($Fn(function(){if(this._welBody.visible()&&this._sViewType===memo.VIEW.PIN&&this._nMaxListColumn!==this._calcMaxColumn()){this._preparePinView(this._htParams.sFilter,document.body.scrollTop)}},this).bind(),300)},this).bind());a.delegate("click","._ct_memo",$Fn(function(e){if(this._oContentEditor.isShown()){return}clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+".memo","","",e.pos());if(!$Element(e.srcElement).hasClass("_m_check")){var h=$Element(e.element).query("input");var f=!h.$value().checked;h.attr("checked",f)}var g=this._welList.query("._ct_memo ._m_check:not(:checked)")==null;this.changeSelectAllCheckbox(g);this.fireEvent("checked",{nCount:this.selectedMemos().length});var d=this._welList.queryAll("._ct_memo ._m_check:checked").length>0;this.fireEvent("enableFunctionButton",{bEnable:d})},this).bind());a.delegate("click","._ct_more",$Fn(function(e){e.stop();var f=this._htParams;f.startIndex=(f.startIndex||0)+(f.length||this._DEFAULT_LENGTH);f.length=this._DEFAULT_MORE_LENGTH;var d=$Json($Cookie().get("more_length")).toObject()||{};d[f.nListNum]=f.startIndex+f.length;$Cookie().set("more_length",$Json(d).toString());this._loadMemoList(f,true);this._clearAllCheckbox()},this).bind());this._welButtonMove.query("._ct_top").attach("click",function(d){d.stop();c._welScrollTarget.$value().scrollTop=0});this._welButtonMove.query("._ct_bottom").attach("click",function(e){e.stop();var d=c._welScrollTarget.$value();d.scrollTop=d.scrollHeight});$Element(this._oContentEditor.getEditorElement()).attach("click",function(d){d.stop($Event.CANCEL_BUBBLE)}).attach("mousedown",function(d){d.stop($Event.CANCEL_BUBBLE)}).attach("dblclick",function(d){d.stop($Event.CANCEL_BUBBLE)});$Element($("editorWrapper")).attach("keyup",$Fn(function(d){if(!$Element(d.element).visible()||memo.global.currentViewType!=memo.VIEW.PIN){return}this._autoHeightEditor()},this).bind());$Element($("editorWrapper")).attach("keydown",$Fn(function(d){if(d.key().keyCode!=13){return}if(!$Element(d.element).visible()||memo.global.currentViewType!=memo.VIEW.PIN){return}this._autoHeightEditor()},this).bind())},_attachListEvent:function(){var b=$Element(this._welList);var a=$Element(this._welFunc);b.delegate("click","img",$Fn(function(c){c.stop();if(this._oContentEditor.isShown()){return}clickcr(c.element,memo.nclicksHelper.findAreaCodeInContent()+ +".photo","","",c.pos());var d=this._makeImageViewerParam(c.element);this._oPhotoViewer.show(c.element,d.aImageUrls,d.nCurrentImageIndex)},this).bind());b.delegate("click","._m_edit",$Fn(function(d){d.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+".edit","","",d.pos());this._disableAllCheckbox();var c=memo.utils.findParentByClass(d.element,"_ct_memo");c.query("input[type=checkbox]").attr("checked",true);this.fireEvent("enableFunctionButton",{bEnable:true});c.data("old-colorid",c.data("colorid"));this._showEditor(c)},this).bind());b.delegate("click","._m_wide",$Fn(function(f){f.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+".memoedit","","",f.pos());var e=memo.utils.findParentByClass(f.element,"_ct_memo"),g=this._oContentEditor.isShown()?this._oContentEditor.getEditorContent():"",d=e.data("id")*1,c=e.data("index")*1;this._hideEditor();if(memo.utils.isNotEmpty(g)){this._saveMemo($Fn(function(){this.stopAutoSave();this._goWideMode(d,c)},this).bind())}else{this._goWideMode(d,c)}},this).bind());b.delegate("dblclick","._ct_memo",$Fn(function(d){d.stop();if($Element(d.srcElement).hasClass("_m_check")){return}var c=$Element(d.element);this._goWideMode(c.data("id")*1,c.data("index")*1)},this).bind());b.delegate("click","._m_impt",$Fn(function(d){d.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+".star","","",d.pos());var c=$Element(d.element);c.toggleClass("active");memo.ajax.call("/memo/changeImportant.nhn",{oParams:{memoSeq:memo.utils.findParentByClass(c.$value(),"_ct_memo").data("id")*1,important:c.hasClass("active")},fCallback:$Fn(function(){this.fireEvent("change",{bFilter:true,bFolder:false})},this).bind()})},this).bind());b.delegate("mousedown","._m_view",function(c){c.stop($Event.CANCEL_BUBBLE)});b.delegate("click","._m_link",function(c){c.stop($Event.CANCEL_BUBBLE)})},_goWideMode:function(b,a){var c=memo.utils.clone(this._htParams);c.nMemoSeq=b;c.nPage=Math.ceil(a/memo.LeftSideMemoUIController.prototype._LENGTH);this.fireEvent("changeAction",{htData:{sAction:memo.ACTION.LEFT_LIST,htParams:c}})},_saveMemo:function(i,a,e){var b=this._getCurrentModifyMemo();if(!b){return}var h=this;if(h._saveInProgress){return}h._saveInProgress=true;var g=this._oAutoSaveTimer,c=this._oMemo||{memoSeq:b.data("id")},d=this._oPrevMemo||{};c.memoContent=this._oContentEditor.getEditorContent();if(c.memoSeq==d.memoSeq&&c.memoContent!==d.memoContent){c.updated=true}if(a&&!g.isRunning()){h._saveInProgress=false;return}g.pause();if(this._checkValidation(c,a)===false){this.resumeAutoSave();if(typeof i==="function"){i()}return}var f=setTimeout(function(){h._saveInProgress=false},3000);memo.ajax.call("/memo/updateMemo.nhn",{oParams:{memoSeq:c.memoSeq,memoContent:c.memoContent,important:b.query("._m_impt").hasClass("active"),todo:this._oContentEditor.hasTodoList(),colorId:b.data("colorid")||0,editorVersion:memo.EDITOR.VERSION.RICH},fCallback:$Fn(function(){if(a){this._showTimeMessage(c.memoSeq,"저장되었습니다.",3000);this.fireEvent("updated",{oMemo:c,bHistoryAdded:e})}else{this.fireEvent("alert",{sMessage:"저장되었습니다."})}c.updated=false;d.memoContent=c.memoContent;this.resumeAutoSave();clearTimeout(f);if(typeof i==="function"){i()}},this).bind(),fErrorCallback:$Fn(function(){this.fireEvent("alert",{sMessage:"저장에 실패하였습니다.",skipAutoHide:true})},this).bind(),useErrorCallbackInCancel:true})},_checkValidation:function(b,a){if(memo.utils.isEmpty(b)){return false}if(memo.utils.isContentEmpty(b.memoContent)){if(a!==true){alert("메모를 입력해 주세요.");this._oContentEditor.focus()}return false}if(b.memoContent.length>memo.MAX_CONTENT_LENGTH){if(a){this._showTimeMessage(b.memoSeq,"작성 가능한 용량을 초과하여 저장할 수 없습니다.",3000)}else{alert("작성 가능한 용량을 초과하여 저장할 수 없습니다.")}this.fireEvent("alert",{sMessage:"저장에 실패하였습니다.",skipAutoHide:true});return false}return !(b.updated!==true||b.deleted)},_showTimeMessage:function(a,d,b){clearTimeout(this._oSaveMessageTimeout);$j("._ct_list").find("._timer_message").hide();$j("._ct_list").find("._update_time").show();if(!d){return}var c=this._getCurrentModifyMemo();if(a==c.data("id")){c.query("._update_time").hide();c.query("._timer_message").text(d).show("inline-block")}if(b>0){this._oSaveMessageTimeout=setTimeout(function(){$j("._ct_list").find("._timer_message").hide();$j("._ct_list").find("._update_time").show()},b)}},_showEditor:function(b){if(this._oContentEditor.isShown()){alert("다른 메모를 수정 중입니다.");return}var a=b.data("id")*1;memo.ajax.call("/memo/select.nhn",{oParams:{memoSeq:a},fCallback:$Fn(function(c){if(memo.global.currentViewType==memo.VIEW.PIN){var d=b.query("._m_area").$value().scrollHeight;this._oContentEditor.setHeight(d+"px")}else{this._oContentEditor.setHeight("")}if(c.editorVersion===memo.EDITOR.VERSION.TEXT){this._convertToHtmlContent(c)}this._oContentEditor.show(b.query("._m_view").parent().$value(),c.memoContent);this._oContentEditor.showToolbar();this._oMemo=c;this._oPrevMemo={memoSeq:c.memoSeq,memoContent:c.memoContent};this.resumeAutoSave();this.fireEvent("startHistory",{oMemo:c});b.addClass("editor_active");b.query("._m_view").hide();this._welList.data("prev-height",this._welList.height())},this).bind()})},_convertToHtmlContent:function(a){a.memoContent=$S(a.memoContent).escapeHTML().toString();a.memoContent=memo.utils.convertTextToHtml(a.memoContent);this._appendOldEditorImage(a)},_appendOldEditorImage:function(e){var f=e.images;if(!f){return}var d=e.memoContent;for(var c=0;c<f.length;c++){d+="<br><br>";var a=f[c].url;var b=memo.PHOTO_INFRA+a;if(!a.endsWith(".gif")&&!a.endsWith(".GIF")){b+="?type=w740"}d+=memo.EDITOR.IMAGE_TEMPLATE.replace("#url#",b)}e.memoContent=d},_autoHeightEditor:function(){if(!this._oContentEditor.isShown()){return}var a=$Element(this._oContentEditor.getEditorElement());var b=memo.utils.findParentByClass(a.$value(),"_ct_memo");if(!b){return}this._rearrangePinViewTop(b.css("left"),b.css("top"))},_hideEditor:function(){this.stopAutoSave();var a=this._oContentEditor.getEditorElement();if(this._oContentEditor.isSimpleEditorView()){$j(a).parents("._ct_new_memo").find("._fake_memo_edit").show()}else{$j(a).parents("._ct_memo").find("._m_view").show()}var b=this._welBody.$value();$j(b).find(".editor_active").removeClass("editor_active");this._oContentEditor.hide();this._oContentEditor.hideToolbar()},_delete:function(a){memo.ajax.call("/memo/deleteMemos.nhn",{oParams:{memoSeqs:a},fCallback:$Fn(function(){this.reload();this.fireEvent("change",{bFilter:true});this.fireEvent("alert",{sMessage:a.length+"개의 메모를 휴지통으로 이동했습니다"})},this).bind()})},_applyUI:function(e,b,h,d,c){var g=e.memoList;var a=[];if(c!==true){this._nIndex=1}$A(g).forEach(function(i){a.push(this._makeMemoMarkup(i,d,b.orderByTarget,this._nIndex++))},this);var f=this._welList;if(c){f.appendHTML(a.join(""))}else{this._welScrollTarget.$value().scrollTop=0;f.html(a.join(""))}this.highlight(b.searchText,$j("._m_area"));this.attachLink($j("._m_area"));if(h===memo.FILTER.TRASH){this.fireEvent("showHideFunctionButton",{sButtonShowType:"TRASH"});memo.global.bInTrash=true}else{this.fireEvent("showHideFunctionButton",{sButtonShowType:"MATRIX"});memo.global.bInTrash=false}f.css("height","auto")},_makeMemoMarkup:function(c,d,f,b){if(c.editorVersion===memo.EDITOR.VERSION.TEXT){this._convertToHtmlContent(c)}try{var a=document.createElement("div");a.innerHTML=c.memoContent;c.memoContent=a.innerHTML}catch(g){}return this._TPL_MEMO.process({nIndex:b,nMemoSeq:c.memoSeq,nFolderId:c.folderId,sContent:c.memoContent,bImportant:c.important,nMemoColorId:c.deleted?1:(c.colorId||0),nDisplayColorId:c.deleted?1:(c.colorId||d[c.folderId]),sLinkUrl:$S(c.linkUrl).escapeHTML().toString(),sLinkDisplayText:$S(c.linkDisplayText).escapeHTML().toString(),sLinkDesc:$S(c.linkDescription).escapeHTML().toString(),sThumbnailUrl:c.linkThumbnail!=null?memo.PHOTO_INFRA+c.linkThumbnail+"?type=f163_163":null,sDate:memo.utils.formatRelativeTime(f==="UPDATE_DATE"?c.modifyDate:c.registerDate),bDeleted:c.deleted,bDiary:c.memoShapeTypeCode==="DIARY"})},showDiff:function(c,a){var b=this._getCurrentModifyMemo();this._showTimeMessage(c.memoSeq,$Date(c.modifyDate).format("H:i")+"에 작성한 메모입니다.",0);b.query("._editor_wrapper").hide();b.query("._m_view").html(a).show()},applyDiff:function(a){this.hideDiff();this._oContentEditor.setContent(a.memoContent);this._saveMemo(null,true)},hideDiff:function(){var a=this._getCurrentModifyMemo();this._showTimeMessage();a.query("._m_view").hide();a.query("._editor_wrapper").show()},highlight:function(a,d){if(!a){return}d=d||document.body;var c=new RegExp("("+RegExp.escape(a)+")","gi");var b="<span class='keyword'>"+a+"</span>";$j("*",d).contents().each(function(e,f){if(f.nodeType===3){var g=$S(f.data).escapeHTML().toString();if(g=g.replace(c,b)){var h=$j("<span>").html(g);$j(f).before(h.contents()).remove()}}})},attachLink:function(c){c=c||document.body;var b=this.URL_REGEX;var a=function(f){var d;var e=f.replace(/&nbsp;/g,"");if(e.match(/https?/)){d=e}else{d="http://"+e}return'<a href="'+d+'" target="_blank">'+e+"</a>"};$j("*",c).contents().each(function(d,e){if(e.nodeType===3){if(!memo.utils.hasLinkedParent(e)){var f=$S(e.data).escapeHTML().toString();if(f=f.replace(b,a)){var g=$j("<span>").html(f);$j(e).before(g.contents()).remove()}}}})},_loadMemoList:function(f,c){var a=memo.utils.buildFilterParams(f.sFilter,f.sSearchText);a.folderId=f.nFolderId||0;var e=f.startIndex||0,d=f.length||this._DEFAULT_LENGTH;if(c){a.startIndex=e;a.sizePerPage=d}else{a.startIndex=0;var b=$Json($Cookie().get("more_length")).toObject()||{};a.sizePerPage=(b[f.nListNum]||e+d)*1}a.contentLength=this._CONTENT_LENGTH;memo.ajax.call("/memo/memoList.nhn",{sTicket:"MEMO_LIST",oParams:a,fCallback:$Fn(function(h){var i=f.sFilter,g=f.nFolderId,j=document.body.scrollTop;this._loadFolder(i,g,$Fn(function(m,l,n){this._processMemoData(h,a,i,m,l,c);var k=this._oNewMemo;if(i===memo.FILTER.FOLDER){k.show(g,l[g],a.startIndex==0)}else{if(i===memo.FILTER.ALL){k.show(n.nFolderId,n.nColorId,a.startIndex==0)}else{k.hide()}}if(c!==true){this.fireEvent("completeLoad",{htParams:f,bEmpty:h.totalCount===0})}else{this._preparePinView(this._htParams.sFilter,j)}this._nTotalCount=h.totalCount},this).bind())},this).bind()})},_loadFolder:function(c,a,b){if(c==memo.FILTER.FOLDER){memo.ajax.call("/folder/select.nhn",{oParams:{folderId:a},fCallback:$Fn(function(e){var d=this._htFolderColorMap;d[e.folderId]=e.colorId;b(e.folderName,d)},this).bind()})}else{if(c!==memo.FILTER.TRASH){memo.ajax.call("/folder/folderList.nhn",{bUsingCache:true,fCallback:$Fn(function(e){var f=this._htFolderColorMap,d=1,g=0;$A(e.folderList).forEach(function(h){f[h.folderId]=h.colorId;if(h.folderType===1){d=h.colorId;g=h.folderId}});b(memo.FILTER_NAME[c],f,{nFolderId:g,nColorId:d})},this).bind()})}else{b(memo.FILTER_NAME[c],null)}}},_processMemoData:function(g,b,h,f,e,d){var a=b.startIndex+b.sizePerPage;this._applyUI(g,b,h,e,d);var c=this._welMore;if(g.totalCount>a){c.show()}else{c.hide()}this.fireEvent("changeFilterInfo",{sName:f,nCount:g.totalCount})},_preparePinView:function(e,f,c){var d=this._welList.child();if(this._sViewType!==memo.VIEW.PIN||d.length===0){return}var b=$Date().time();this["_nLoadingImage"+b]=0;this["_bLoading"+b]=true;$A(d).forEach(function(g){g.addClass("pinview")},this);this["_bLoading"+b]=false;this._arrangePinView(e,b,f);var a=this;if(!c){$j("._ct_list").imagesLoaded().always(function(){a._preparePinView(e,document.body.scrollTop,true)})}},_rearrangePinViewTop:function(d,a){var g=this._welList.queryAll("._ct_memo[@left="+d+"]"),f=this._welList;var c=null;$A(g).forEach(function(i){var h=parseInt(i.css("top"));if(h>parseInt(a)){if(c!=null){i.css("top",(parseInt(c.css("top"))+parseInt(c.css("height"))+16)+"px")}}c=i});var e=g[g.length-1];var b=parseInt(e.css("top"))+e.height();if(f.height()<b){f.height(b)}},_calcMaxColumn:function(){return Math.floor((this._welList.width())/this._MEMO_WIDTH)},_arrangePinView:function(e,j,d){var c=0;if(this["_bLoading"+j]===false&&this["_nLoadingImage"+j]===0){try{delete this["_bLoading"+j]}catch(g){this["_bLoading"+j]=null}try{delete this["_nLoadingImage"+j]}catch(g){this["_nLoadingImage"+j]=null}var f=this._nMaxListColumn=this._calcMaxColumn();var k=[];for(c=0;c<f;c++){k[c]=0}if(e===memo.FILTER.FOLDER||e===memo.FILTER.ALL){k[0]=316}var h=this._welList.child();var a=0;$A(h).forEach(function(m){var l=0;var i=k[0];for(c in k){if(k[c]<i){i=k[c];l=c}}m.css({position:"absolute",left:(l*this._MEMO_WIDTH)+"px",top:(i)+"px"});k[l]+=m.height()+16},this);var b=0;for(c in k){if(k[c]>b){b=k[c]}}this._welList.height(b);document.body.scrollTop=d}},changeSelectAllCheckbox:function(b){var a=this._welFunc.query("._ct_all > input[type=checkbox]");a.attr("checked",b)},selectedMemos:function(){var b=this._welList.queryAll("input._m_check[checked=true]");var a=[];$A(b).forEach(function(c){a.push(memo.utils.findParentByClass(c,"_ct_memo"))});return a},selectedMemoSeqs:function(){var a=this.selectedMemos();var b=[];$A(a).forEach(function(c){b.push(c.data("id")*1)});return b},getViewType:function(){return this._sViewType},changeFolderColor:function(a,c){this._htFolderColorMap[a]=c;var b=this._welList.queryAll(">._ct_memo[data-folderid="+a+"][data-colorid=0]");if(b.length>0){$ElementList(b).removeClass(/color[0-9]+/.exec(b[0].$value().className)[0]).addClass("color"+c)}if(this._oNewMemo.getFolderId()===a){this._oNewMemo.show(a,c)}},changeDefaultFolder:function(b,c){var a=this._oNewMemo;if(a.isVisible()){a.show(b,c)}},changeViewType:function(d){if(this._welBody.visible()){var c=this._htParams.sFilter;var a=this._htParams.nFolderId;if(this._sViewType!==d){this._sViewType=d;if(d===memo.VIEW.MATRIX){var b=this._welList.child();$A(b).forEach(function(e){e.removeClass("pinview").attr("style",null);var f=e.query("img._m_img");if(f){var g=f.attr("src");if(memo.utils.isNotEmpty(g)){f.attr(g.substr(0,g.indexOf("?"))+"?type=f90_90")}}},this);this._welList.css("height","auto")}else{this._preparePinView(c)}}}else{this._sViewType=d}this._oNewMemo.changeViewType(this._sViewType)},stopAutoSave:function(){this._oAutoSaveTimer.pause()},resumeAutoSave:function(){this._oAutoSaveTimer.resume();this._saveInProgress=false},showHistoryLayer:function(){this._saveMemo(null,true,true);this.fireEvent("showHistoryLayer",{oMemo:this._oMemo&&this._oMemo.updated?this._oMemo:null})},reload:function(){this.load(this._htParams)},load:function(a){this.stopAutoSave();a.nListNum=a.nListNum||$Date().format("His");this._htParams=a;this._loadMemoList(a);this._clearAllCheckbox();this.fireEvent("enableFunctionButton",{bEnable:false});this._oContentEditor.hideToolbar();this.fireEvent("checked",{nCount:0})},show:function(){this._welBody.show();this._preparePinView(this._htParams.sFilter,0);this._oContentEditor.hide()},hide:function(){this._welBody.hide();this.stopAutoSave()},deleteMemo:function(){var a=this.selectedMemoSeqs();if(a.length>0){this._delete(a)}},folderMove:function(a){if(this.selectedMemoSeqs().length>0){this._oFolderSelectionLayer.show(a)}},permanentDelete:function(){var a=this.selectedMemoSeqs();if(a.length>0){if(confirm("메모를 영구삭제하시겠습니까?\n영구삭제한 메모는 복구할 수 없습니다.")){memo.ajax.call("/memo/deleteTrashBoxMemos.nhn",{oParams:{memoSeqs:a},fCallback:$Fn(function(){this.fireEvent("alert",{sMessage:a.length+"개의 메모를 영구 삭제했습니다."});this.reload();this.fireEvent("change",{bFilter:true})},this).bind()})}else{return}}},emptyTrash:function(){if(confirm("휴지통을 비우면,\n지워진 메모(중요메모 포함)들은 복구할 수 없습니다.\n\n휴지통을 비우시겠습니까?")){memo.ajax.call("/folder/emptyTrashBox.nhn",{fCallback:$Fn(function(){this.fireEvent("change",{bFilter:true,bFolder:false});this.reload()},this).bind()})}},saveMemo:function(){if(this._oContentEditor.isLargeEditorView()){return}var a=this._oContentEditor.getEditorContent();if(memo.utils.isContentEmpty(a)){alert("메모를 입력해 주세요");this._oContentEditor.focus();return}if(this._oContentEditor.isSimpleEditorView()){this._oNewMemo.saveMemo()}else{this._saveMemo($Fn(function(){this.stopAutoSave();var b=memo.utils.findParentByClass(this._oContentEditor.getEditorElement(),"_ct_memo");if(b){b.query("._m_view").html(a).show();this._hideEditor();this._rearrangePinViewTop(b.css("left"),b.css("top"));this.attachLink($j(b._element).find("._m_area"))}},this).bind())}this._clearAllCheckbox()},cancelEdit:function(){var d=true;var b=memo.utils.findParentByClass(this._oContentEditor.getEditorElement(),"_ct_memo");if(!b){d=false;b=memo.utils.findParentByClass(this._oContentEditor.getEditorElement(),"_ct_new_memo")}if(b){var c=parseInt(b.data("old-colorid")||0);var a=parseInt(b.data("colorid")||0);if(c!==a){this._changeColor(c)}}if(d&&this._oPrevMemo&&this._oPrevMemo.memoContent){b.query("._m_view").html(this._oPrevMemo.memoContent)}this._hideEditor();this._clearAllCheckbox();if(this._sViewType===memo.VIEW.PIN){if(b&&b.hasClass("_ct_memo")){this._rearrangePinViewTop(b.css("left"),b.css("top"))}}},selectAllButtonEvent:function(){var a=this._welFunc.query("._ct_all > input").attr("checked");this._allCheckboxChecked(a);this.fireEvent("checked",{nCount:this.selectedMemos().length});this.fireEvent("enableFunctionButton",{bEnable:a})},_allCheckboxChecked:function(a){$ElementList($Element(this._welList).queryAll("input[type=checkbox]")).attr("checked",a)},_disableAllCheckbox:function(){$ElementList($Element(this._welList).queryAll("input[type=checkbox]")).attr("checked",false).attr("disabled","disabled");this._welFunc.query("._ct_all > input").attr("checked",false).attr("disabled","disabled");this.fireEvent("enableFunctionButton",{bEnable:false});this.fireEvent("checked",{nCount:0})},_clearAllCheckbox:function(){$ElementList($Element(this._welList).queryAll("input[type=checkbox]")).attr("checked",false).attr("disabled","");this._welFunc.query("._ct_all > input").attr("checked",false).attr("disabled","");this.fireEvent("enableFunctionButton",{bEnable:false});this.fireEvent("checked",{nCount:0})},showColorSelectLayer:function(a){this._oColorLayer.show(a)},_changeColor:function(d){var c=this._getCurrentModifyMemo();c.removeClass(/color[0-9]+/.exec(c.$value().className)[0]);if(d===0){var b=parseInt(c.data("folderid"));var a=this._htFolderColorMap[b];c.addClass("color"+a)}else{c.addClass("color"+d)}c.data("colorid",d);this._oMemo.updated=true},_getCurrentModifyMemo:function(){if(this._oContentEditor.isSimpleEditorView()){return memo.utils.findParentByClass(this._oContentEditor.getEditorElement(),"_ct_new_memo")}else{return memo.utils.findParentByClass(this._oContentEditor.getEditorElement(),"_ct_memo")}},_makeImageViewerParam:function(e){var b=$Element(e);var d=memo.utils.findParentByClass(e,"_ct_memo");var a=[];var f=0;var c=0;$A(d.queryAll("img")).forEach(function(g){if(g.isEqual(b)){f=c}a.push(g.attr("src"));c++});return{aImageUrls:a,nCurrentImageIndex:f}}}).extend(jindo.Component);RegExp.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};memo.ContentListNewMemo=$Class({$init:function(b,c,a){this._oContentEditor=a;this._defineElement(b);this._loadComponent();this._attachEvent(b);this._loadTemp();this.changeViewType(c)},_defineElement:function(b){var a=this._welBody=$Element(b);this._welFakeEditor=a.query("._fake_memo_edit");this._welClone=a.query("._new_memo_clone");this._welImportant=a.query("._new_memo_impt");this._welTool=a.query("._new_memo_tool")},_loadComponent:function(){},_attachEvent:function(c){var b=$Element(c);var a=$Element(this._welFakeEditor);b.delegate("click","._memo_simple_editor_inner",$Fn(function(d){d.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+"*n.new","","",d.event);if(this._oContentEditor.isShown()){return}this.fireEvent("disableAllCheckbox");b.addClass("editor_active");a.hide();this.fireEvent("startHistory");this._oContentEditor.showToolbar(true);this._oContentEditor.show(d.element,a.hasClass("new")?"":a.html());this._oContentEditor.focus()},this).bind());b.delegate("click","._new_memo_wide",$Fn(function(d){d.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+"*n.godetail","","",d.event);var e=this._oContentEditor.getEditorContent();if(memo.utils.isContentEmpty(e)){this.fireEvent("writeNewMemo")}else{this._save(e,this._isImportant(),true)}},this).bind());this._welImportant.attach("click",$Fn(function(d){d.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+"*n.star","","",d.event);$Element(d.currentElement).toggleClass("active")},this).bind())},saveMemo:function(){this._save(this._oContentEditor.getEditorContent(),this._isImportant())},_save:function(d,c,b){if(d.length>memo.MAX_CONTENT_LENGTH){this.fireEvent("alert",{sMessage:"저장에 실패하였습니다."});alert("작성 가능한 용량을 초과하여 저장할 수 없습니다.");return}if(memo.utils.isContentEmpty(d)){this._cancel();this._deleteTempMemo();return}var a=memo.utils.findParentByClass(this._oContentEditor.getEditorElement(),"_ct_new_memo");memo.ajax.call("/memo/writeMemo.nhn",{oParams:{important:c,memoContent:d,folderId:this._nFolderId,todo:this._oContentEditor.hasTodoList(),colorId:a.data("colorid")||0,editorVersion:memo.EDITOR.VERSION.RICH},fCallback:$Fn(function(e){this._cancel();this._deleteTempMemo();this.fireEvent("alert",{sMessage:"저장되었습니다."});if(b===true){this.fireEvent("wide",{nMemoSeq:e.memoSeq})}else{this.fireEvent("write")}},this).bind(),fErrorCallback:$Fn(function(){this.fireEvent("alert",{sMessage:"저장에 실패하였습니다."})},this).bind()})},_edit:function(c,b){var a=this._welFakeEditor;a.removeClass("new").text(c);this._welImportant.cssClass({active:b})},_cancel:function(){var a=this._welFakeEditor;var b=this._welBody.$value();$j(b).removeClass("editor_active");this._oContentEditor.hide();this._oContentEditor.hideToolbar();a.addClass("new").html("<p>간단한 메모는 여기에</p>");a.show();this._welImportant.removeClass("active");this._welBody.data("colorid",0);if(this._nColorId){this._changeColor(this._nColorId)}},_isImportant:function(){return this._welImportant.hasClass("active")},_loadTemp:function(){memo.ajax.call("/memo/selectTempMemo.nhn",{fCallback:$Fn(function(a){if(a.autoSaveMemoExist==="Y"){this._edit(a.autoSaveMemo.memoContent,a.autoSaveMemo.importantMemoYn==="Y")}else{this._cancel()}},this).bind()})},_deleteTempMemo:function(){memo.ajax.call("/memo/deleteTempMemo.nhn",{fCallback:function(){}})},_changeColor:function(d){var a=this._welBody;var c=parseInt(a.data("colorid")||0);if(c!==0){return}var b=/color[0-9]+/.exec(a.$value().className);if(b){b=b[0];a.removeClass(b)}a.addClass("color"+d)},changeViewType:function(a){if(a==memo.VIEW.MATRIX){this._sNclickPrefix="gdv"}else{this._sNclickPrefix="pnv"}},isVisible:function(){return this._welBody.visible()},getFolderId:function(){return this._nFolderId},hide:function(){this._welBody.hide()},show:function(a,b,c){this._nFolderId=a;this._nColorId=b;this._changeColor(b);this._welBody.data("folderid",a);this._welBody.data("old-colorid",0);this._welBody.show()}}).extend(jindo.Component);memo.ContentEditorUIController=$Class({_TPL_IMAGE:$Template('<li class="_edt_image"><span><img src="{=sPhotoInfra}{=sUrl}?type=w740" alt="{=sName}" onmousedown="return false" ondragstart="return false"><a href="/memo/downloadImage.nhn?imageName=memo_image&imageUrl={=sEncodedUrl}" class="putin" onclick="clickcr(this,\'memo.attdown\',\'\',\'\',event);">담기</a><a href="#" class="del _edt_image_delete dim" data-index="{=nIndex}" data-url="{=sUrl}" onclick="clickcr(this,\'memo.attdel\',\'\',\'\',event);">삭제</a></span></li>'),_TPL_DIARY_DATE:$Template('<span class="blind">다이어리 작성 날짜 : </span><span class="date ">{=yyyymmdd}</span> <span class="day">({=dayOfWeek})</span> <span class="ico"><span class="blind">다른 날짜 선택 하기</span></span>'),_WEEK_CLASS_NAME:["sun","mon","tue","wed","thu","fri","sat"],_WEEK_KO_NAME:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],$init:function(b,a){this._oContentEditor=a;this._defineElement(b);this._loadComponent(b);this._attachEvent(b);this._sViewType=$Cookie().get(memo.utils.getUserInfo().sUserId+"_view_type")||memo.VIEW.MATRIX;this._oPrevMemo;this._saveInProgress=false},_defineElement:function(b){var a=$Element(b);this._welFunc=$Element("content").query("._ct_func");this._welBody=a;this._welLink=a.query("._edt_link");this._welImportant=a.query("._edt_impt");this._welWrap=a.query("._edt_wrap");this._welTime=a.query("._edt_time");this._welDiaryDate=a.query("._edt_diary_date");this._welViewerArea=a.query("._edt_viewer_area");this._welHistoryButtons=a.query("._edt_history_btn");this._welTrashArea=a.query("._edt_trash_area");this._welToolbar=$Element("editorToolbar");this._welColor=this._welToolbar.query("._edt_color")},_loadComponent:function(){this._oInfoLayer=new memo.InfoLayer().attach({close:function(b){$Cookie().set(b.sKey,"hide",365*2)}});this._oColorLayer=new memo.ColorLayer().attach({select:$Fn(function(b){if(memo.global.currentViewType!=memo.VIEW.EDITOR){return}this._changeColor(b.nColorId);this._oContentEditor.focus()},this).bind()});this._oFoldeSelectionLayer=new memo.FolderSelectionLayer().attach({select:$Fn(function(d){var e=this._oMemo,b=e.memoSeq,c=d.nFolderId;if(e.folderId===c){return}memo.ajax.call("/memo/changeFolder.nhn",{oParams:{memoSeqs:[b],folderId:c},fCallback:$Fn(function(){this._changeFolder(d.nFolderId,d.sFolderName,d.nColorId);this.fireEvent("changeFolder",{nMemoSeq:b,folderId:c});this.fireEvent("alert",{sMessage:d.sFolderName+" 폴더로 이동하였습니다."})},this).bind()})},this).bind()});var a=new jindo.Timer();this._oAutoSaveTimer=a;a.start($Fn(function(){this._save(true);return true},this).bind(),5000);a.pause();this._oDatePcikerParams={elInput:this._welWrap.query("._edt_diary_date_open").$value(),htOption:{bDefaultSet:false,sDateFormat:"yyyymmdd",bReadOnly:false}};this._oDatePicker=new jindo.DatePickerEx({Calendar:{sTitleFormat:"yyyy.mm",sDateFormat:"yyyy.mm.dd"},LayerManager:{sCheckEvent:"mousedown",nShowDelay:0,nHideDelay:0}});this._oDatePicker.addDatePickerSet(this._oDatePcikerParams).attach({select:$Fn(function(b){var d=b.sText,c=this._oMemo;this._changeDiaryDate($Date(d),true);if(d!==c.memoConjunctionYmd){c.memoConjunctionYmd=d;c.updated=true}},this).bind()}).attach({click:$Fn(function(b){if(this._welWrap.hasClass("mm_dimmed")){b.stop()}},this).bind()});this._oMemoSendLayer=memo.MemoSendLayer.prototype.getInstance();this._oMemoTypeLayer=new memo.MemoTypeLayer().attach({setMemoType:$Fn(function(b){this._setMemoType(b.memoType)},this).bind()})},_attachEvent:function(a){var b=$Element(this._welFunc);b.delegate("click","._edt_save",$Fn(function(c){c.stop();if(this._welWrap.hasClass("mm_dimmed")){return}if(this._oContentEditor.isLargeEditorView()==false){return}this._save()},this).bind());this._welToolbar.query("._edt_photo").attach("change",$Fn(this.imageUpload,this).bind());this._welImportant.attach("click",$Fn(function(c){c.stop();if(this._oMemo.deleted||this._welWrap.hasClass("mm_dimmed")){return}var e=$Element(c.currentElement).toggleClass("active").hasClass("active"),d=this._oMemo;this.fireEvent("changeImportant",{nMemoSeq:d.memoSeq,bImportant:e});if(d.memoSeq>0){memo.ajax.call("/memo/changeImportant.nhn",{oParams:{memoSeq:d.memoSeq,important:e},fCallback:$Fn(function(){d.important=e;this.fireEvent("change",{bFilter:true,bFolder:false})},this).bind()})}else{d.important=e}},this).bind());this._welHistoryButtons.delegate("click","._history_apply",$Fn(function(c){c.stop();this.fireEvent("applyDiff")},this).bind());this._welHistoryButtons.delegate("click","._history_cancel",$Fn(function(c){c.stop();this.hideDiff()},this).bind())},applyDiff:function(b){var a=b;a.updated=true;a.affectedFilter=true;this._oMemo=a;this._applyUI(a);this._save(true)},hideDiff:function(){this._applyUI(this._oMemo)},_buildSaveParams:function(a){return{memoSeq:a.memoSeq||0,memoContent:a.memoContent,important:a.important||false,todo:this._oContentEditor.hasTodoList(),colorId:a.colorId||0,memoShapeTypeCode:a.memoShapeTypeCode||"BASIC",memoConjunctionYmd:a.memoConjunctionYmd||null,folderId:a.folderId,editorVersion:memo.EDITOR.VERSION.RICH}},_checkValidation:function(b,a){if(memo.utils.isEmpty(b)){return false}if(memo.utils.isContentEmpty(b.memoContent)){if(a!==true){alert("메모를 입력해 주세요.");this._oContentEditor.focus()}return false}if(b.memoContent.length>memo.MAX_CONTENT_LENGTH){this._showTimeMessage("작성 가능한 용량을 초과하여 저장할 수 없습니다.",0);this.fireEvent("alert",{sMessage:"저장에 실패하였습니다.",skipAutoHide:true});return false}return !(b.updated!==true||b.deleted)},_showTimeMessage:function(b,a,c){clearTimeout(this._oSaveMessageTimeout);var d=this._welTime.text(b);if(c){d.addClass("alert")}else{d.removeClass("alert")}if(a>0){this._oSaveMessageTimeout=setTimeout(function(){d.text("");d.removeClass("alert")},a)}},_save:function(c,f){var i=this;if(i._saveInProgress){return}i._saveInProgress=true;var h=this._oAutoSaveTimer,d=this._oMemo||{},b=(d.memoSeq===0),a=d.affectedFilter,e=this._oPrevMemo||{};d.memoContent=this._oContentEditor.getEditorContent();if(d.memoContent!=e.memoContent){d.updated=true}if(!h.isRunning()){i._saveInProgress=false;return}h.pause();if(this._checkValidation(d,c)===false){this.resumeAutoSave();return}var g=setTimeout(function(){i._saveInProgress=false},3000);this._showTimeMessage("저장 중 입니다.");memo.ajax.call("/memo/"+(b?"writeMemo.nhn":"updateMemo.nhn"),{oParams:this._buildSaveParams(d),fCallback:$Fn(function(j){d.memoSeq=j.memoSeq;d.memoPlainContent=j.memoPlainContent;d.updated=false;d.affectedFilter=false;d.modifyDate=$Date().time();e.memoContent=d.memoContent;this.resumeAutoSave();clearTimeout(g);this._showTimeMessage("저장되었습니다.",3000);if(!c){this.fireEvent("alert",{sMessage:"저장되었습니다."})}else{this.fireEvent("alert",{sMessage:false})}this.fireEvent("updated",{nMemoSeq:d.memoSeq,sContent:$S(j.memoPlainContent).trim().toString().length>0?j.memoPlainContent.substr(0,30):"메모",bNew:b,bAffectedFilter:a,oMemo:d,bHistoryAdded:f})},this).bind(),fErrorCallback:$Fn(function(){this.resumeAutoSave();clearTimeout(g);this._showTimeMessage("저장에 실패하였습니다.",0,true);this.fireEvent("alert",{sMessage:"저장에 실패하였습니다.",skipAutoHide:true})},this).bind(),useErrorCallbackInCancel:true})},_changeColor:function(f,c,a){var e=this._welWrap,g=this._welColor,d=parseInt(g.data("id"),10),b=this._oMemo;if(d>0){g.removeClass("color"+d);e.removeClass("color"+d)}g.addClass("color"+f);g.data("id",f);e.addClass("color"+f);if(a!==true&&c!==true&&b.colorId!==f){b.colorId=f;b.updated=true}},_changeFolder:function(b,a,d){var c=this._oMemo;if(c.colorId===0){this._changeColor(d,true)}if(c.folderId!==b){c.folderId=b;c.updated=true}},_changeDiaryDate:function(b,d){var e=b.format("Y.m.d"),a=b.day();var c=this._TPL_DIARY_DATE.process({yyyymmdd:e,dayOfWeek:this._WEEK_CLASS_NAME[a]});if(d!==true){this._oDatePicker.setDate(this._oDatePcikerParams,{nYear:parseInt(e.substr(0,4),10),nMonth:parseInt(e.substr(5,2),10),nDate:parseInt(e.substr(8,2),10)})}this._welDiaryDate.html(c)},_changeMemoShapeType:function(a,c){var b=this._welDiaryDate;if(a==="DIARY"){this._changeDiaryDate($Date(c));b.show()}else{b.hide()}this._oMemoTypeLayer.setMemoTypeUI(a)},_applyImage:function(b){if(!b){return}for(var a=0;a<b.length;a++){this._oContentEditor.insertImage(b[a].url)}},applyUI:function(b,a,c){this._applyUI(b,a,c)},_applyUI:function(d,b,h){h=!!h;var e=this._welWrap,f=this._welLink,a=d.linkThumbnail,c=f.query("._edt_link_thumb"),g;this._welWrap.cssClass("mm_dimmed",h);if(d.deleted){e.addClass("mm_waste");this.fireEvent("showHideFunctionButton",{sButtonShowType:"TRASH"});memo.global.bInTrash=true}else{e.removeClass("mm_waste");this.fireEvent("showHideFunctionButton",{sButtonShowType:"LARGE"});memo.global.bInTrash=false;memo.ajax.call("/folder/select.nhn",{oParams:{folderId:d.folderId},fCallback:$Fn(function(i){this._changeFolder(i.folderId,i.folderName,i.colorId)},this).bind()})}this._changeMemoShapeType(d.memoShapeTypeCode,d.memoConjunctionYmd);if(d.colorId>0||d.deleted){this._changeColor(d.colorId||1,false,true)}if(d.important){this._welImportant.addClass("active")}else{this._welImportant.removeClass("active")}if(!h&&d.deleted==false){this._welViewerArea.hide();this._welHistoryButtons.hide();$j("#largeEditor").show();this._oContentEditor.show($("largeEditor"),d.memoContent);this._showTimeMessage(d.memoSeq>0?"최종수정 : "+memo.utils.formatRelativeTime(d.modifyDate):"")}else{$j("#largeEditor").hide();g=this._welViewerArea.show().query("._edt_viewer");if(d.deleted){g.html(d.memoContent);this._showTimeMessage(d.memoSeq>0?"최종수정 : "+memo.utils.formatRelativeTime(d.modifyDate):"")}else{g.html(b);this._welHistoryButtons.css("display","");this._showTimeMessage($Date(d.modifyDate).format("H:i")+"에 작성한 메모입니다.")}}if(memo.utils.isNotEmpty(d.linkUrl)){this._welWrap.addClass("link_og");f.query("._edt_link_anchor").attr("href",d.linkUrl||"");f.query("._edt_link_url").text(d.linkUrl||"");f.query("._edt_link_title").text(d.linkDisplayText||"");f.query("._edt_link_desc").text(d.linkDescription||"");if(memo.utils.isNotEmpty(a)){c.parent().show();c.attr("src",memo.PHOTO_INFRA+a+"?type=f163_163")}else{c.parent().hide()}f.show()}else{f.hide();this._welWrap.removeClass("link_og")}},_loadNewMemo:function(a){this._oContentEditor.clearEditor();this._oMemo={memoSeq:0,folderId:a,modifyDate:$Date().time(),images:[],colorId:0,deleted:false,memoContent:this._oContentEditor.getEditorContent()};this._oPrevMemo={memoContent:this._oContentEditor.getEditorContent()};var b=this._oMemo;this._applyUI(b);this.fireEvent("completeLoad",{htParams:this._htParams});this.fireEvent("startHistory",{oMemo:b})},_loadMemo:function(a){this._oContentEditor.clearEditor();memo.ajax.call("/memo/select.nhn",{sTicket:"EDITOR",oParams:{memoSeq:a},fCallback:$Fn(function(b){this._oMemo=b;if(b.editorVersion===memo.EDITOR.VERSION.TEXT){this._convertToHtmlContent(b)}this._applyUI(b);this.fireEvent("completeLoad",{htParams:this._htParams});this.fireEvent("startHistory",{oMemo:b});b.memoContent=this._oContentEditor.getEditorContent();this._oPrevMemo={memoContent:b.memoContent}},this).bind()})},_convertToHtmlContent:function(a){a.memoContent=$S(a.memoContent).escapeHTML().toString();a.memoContent=memo.utils.convertTextToHtml(a.memoContent);this._appendOldEditorImage(a)},uploadedPhoto:function(d,a){var c=this._oMemo,b;if(a==="FAIL1"){alert("10MB 이하의 파일만 업로드 가능합니다.")}else{if(a==="FAIL2"){alert("파일 이름은 100글자까지 가능합니다.")}else{b={url:d};this._applyImage([b],false);if(!c){return}if(memo.utils.isEmpty(c.images)){c.images=[]}c.images.push(b);c.updated=true;c.affectedFilter=true;this._save(true)}}},changeImportant:function(a,c){var b=this._oMemo;if(b.memoSeq===a){b.important=c;this._welImportant.cssClass({active:c})}},changeFolderColor:function(a,b){if(this._oMemo.folderId===a){this._changeColor(b,true)}},stopAutoSave:function(){this._oAutoSaveTimer.pause()},resumeAutoSave:function(){this._oAutoSaveTimer.resume();this._saveInProgress=false},showHistoryLayer:function(){this._save(true,true);this.fireEvent("showHistoryLayer",{oMemo:this._oMemo&&this._oMemo.updated?this._oMemo:null})},reload:function(){this.load(this._htParams)},load:function(a){this._save(true);this._htParams=a;this._oContentEditor.setHeight("");this._oContentEditor.showToolbar();this.fireEvent("enableFunctionButton",{bEnable:true});this._welFunc.query("._ct_all > input").attr("checked",false).attr("disabled","disabled");if(a.nMemoSeq>0){this._loadMemo(a.nMemoSeq)}else{if(a.sFilter===memo.FILTER.FOLDER){this._loadNewMemo(a.nFolderId)}else{if(a.sFilter===memo.FILTER.ALL){memo.ajax.call("/folder/selectDefault.nhn",{fCallback:$Fn(function(b){this._loadNewMemo(b.folderId)},this).bind()})}}}},show:function(){this._welBody.show();if(!this._oMemo.deleted){this.resumeAutoSave()}this._oContentEditor.showToolbar()},hide:function(){this._welBody.hide();this._oInfoLayer.hideAll()},_appendOldEditorImage:function(e){var f=e.images;if(!f){return}var d=e.memoContent;for(var c=0;c<f.length;c++){d+="<br><br>";var a=f[c].url;var b=memo.PHOTO_INFRA+a;if(!a.endsWith(".gif")&&!a.endsWith(".GIF")){b+="?type=w740"}d+=memo.EDITOR.IMAGE_TEMPLATE.replace("#url#",b)}e.memoContent=d},deleteMemo:function(){var a=this._oMemo.memoSeq;if(a>0){if(confirm("메모를 삭제하시겠습니까?\n삭제한 메모는 휴지통으로 이동됩니다.")){memo.ajax.call("/memo/deleteMemos.nhn",{oParams:{memoSeqs:[a]},fCallback:$Fn(function(){this.fireEvent("deleted",{nMemoSeq:a});this.fireEvent("alert",{sMessage:"1개의 메모를 휴지통으로 이동했습니다"})},this).bind()})}}},folderMove:function(a){if(this._welWrap.hasClass("mm_dimmed")){return}this._oFoldeSelectionLayer.show(a,this._oMemo.memoSeq)},sendToCalendar:function(b){if(this._welWrap.hasClass("mm_dimmed")){return}var a=this._oMemo;if(a.memoSeq===0){alert("메모를 저장하지 않으셨습니다.");return}this._oMemoSendLayer.show(b,{nMemoSeq:a.memoSeq,sMemoPlainContent:a.memoPlainContent||"",bImportant:a.important||false})},showMemoTypeLayer:function(a){this._oMemoTypeLayer.show(a,{})},_setMemoType:function(a){var b=this._oMemo;if(a=="BASIC"){this._changeMemoShapeType("BASIC");b.memoShapeTypeCode="BASIC";b.memoConjunctionYmd=null}else{var c=$Date();this._changeMemoShapeType("DIARY",c);b.memoShapeTypeCode="DIARY";b.memoConjunctionYmd=c.format("Ymd")}b.updated=true;b.affectedFilter=true},permanentDelete:function(){var b=this._oMemo,a=b.memoSeq;if(confirm("메모를 영구삭제하시겠습니까?\n영구삭제한 메모는 복구할 수 없습니다.")&&b.deleted===true){memo.ajax.call("/memo/deleteTrashBoxMemos.nhn",{oParams:{memoSeqs:[a]},fCallback:$Fn(function(){this.fireEvent("permanentDeleted",{nMemoSeq:a})},this).bind()})}},saveMemo:function(){if(this._oContentEditor.isLargeEditorView()==false){return}this._save()},showColorSelectLayer:function(a){this._oColorLayer.show(a)},imageUpload:function(b){if(this._welWrap.hasClass("mm_dimmed")){return}var a=$Element(b.element),d=a.text().split("."),c=d[d.length-1].toUpperCase();memo.imageUploader.uploadImage(c)},viewWhenEmptyMemo:function(){this._oContentEditor.hideToolbar();this.fireEvent("showHideFunctionButton",{sButtonShowType:"MATRIX"});this.fireEvent("enableFunctionButton",{bEnable:false})},hideLayers:function(){this._oMemoTypeLayer.hide();this._oMemoSendLayer.hide();this._oFoldeSelectionLayer.hide();this._oColorLayer.hide()}}).extend(jindo.Component);memo.ContentEditor=$Class({$init:function(){this._defineElement();this._loadComponent();this._attachEvent();this._EMPTY_CONTENT=" "},_defineElement:function(){this._welLinkLayer=$Element("linkLayer");this._jelEditor=$j("#editorWrapper");this._elEditor=this._jelEditor[0]},_loadComponent:function(){var a=this._welLinkLayer.$value();new jindo.LayerManager(a,{sCheckEvent:"mousedown",nHideDelay:0,nCheckDelay:0}).link(a);this._memoEditor=new MemoEditor.MemoEditor(this._elEditor,this._EMPTY_CONTENT,{});this._memoEditor.registerFileHandler(this._fileHandler);this._memoEditor.registerPasteHandler(function(b){if(b&&memo.utils.editor.checkHasInvalidStyle(b)){return memo.utils.editor.removeInvalidStyle(b)}return false})},_attachEvent:function(){},autoResize:function(){},focus:function(){this._memoEditor.focus()},setContent:function(a){this.focus();a=a.replace(/\n/g,"<br/>");this._setContentToWorksEditor(a)},_setContentToWorksEditor:function(a){this._memoEditor.setContent(a);this._memoEditor.focus()},getEditorContent:function(){return this._memoEditor.getContent()},insertImage:function(a){var b=memo.PHOTO_INFRA+a;if(!a.endsWith(".gif")&&!a.endsWith(".GIF")){b+="?type=w740"}this._memoEditor.focus();this._memoEditor.insertHTML(memo.EDITOR.IMAGE_TEMPLATE.replace("#url#",b)+"<br><br>");$j("._memoInlineImage").imageReloader()},getEditorElement:function(){return this._elEditor},isShown:function(){return this._jelEditor.find(":visible").length>0},show:function(b,a){this._jelEditor.show().appendTo(b);this._memoEditor.setContent(a?a:this._EMPTY_CONTENT);var c=this;setTimeout(function(){c._memoEditor.focus()},100)},hide:function(){this._jelEditor.hide()},showToolbar:function(a){$j("._ct_refresh").hide();if(a){$j("._edt_history").hide();$j("._m_cancel").css("display","inline-block")}else{$j("._edt_history").css("display","inline-block");$j("._m_cancel").hide()}this._memoEditor.showToolbar()},hideToolbar:function(){var a=memo.global.currentViewType;if(a==memo.VIEW.MATRIX||a==memo.VIEW.PIN){$j("._ct_refresh").css("display","inline-block")}$j("._edt_history").hide();$j("._m_cancel").hide();this._memoEditor.hideToolbar()},setHeight:function(a){this._jelEditor.css("height",a)},isLargeEditorView:function(){return this._jelEditor.parent().attr("id")=="largeEditor"},isSimpleEditorView:function(){return this._jelEditor.parent().attr("id")=="newSimpleEditor"},hasTodoList:function(){return this._jelEditor.find(".memo_todo_list li").length>0},clearEditor:function(){this._memoEditor.setContent(this._EMPTY_CONTENT)},_fileHandler:function(g,f){if(memo.utils.isIE()){return}var e=g.files||g.items||[];var d=e.length;var c;var a=this;if(d>0){c=e[0]||{};if(d===1&&c.type&&c.type.match(/image.*/)){var b=typeof c.getAsFile==="function"?c.getAsFile():c;memo.imageUploader.uploadImageFromClipboard(b,"wysiwyg",function(h){var i=memo.PHOTO_INFRA+h;if(!h.endsWith(".gif")&&!h.endsWith(".GIF")){i+="?type=w740"}a.insertHTML(memo.EDITOR.IMAGE_TEMPLATE.replace("#url#",i)+"<br><br>");a.focus();$j("._memoInlineImage").imageReloader()})}}}}).extend(jindo.Component);function ContentSmallEditor(){this._EDITOR_TEMPLETE='<div class="memo_inner _small_editor" style="display: none" >';this._elEditor;this._init()}ContentSmallEditor.prototype={_init:function(){this._createMemoEditor()},_createMemoEditor:function(){this._elEditor=$j(this._EDITOR_TEMPLETE)[0];$j(this._elEditor).appendTo("body");this._memoEditor=new MemoEditor.MemoEditor(this._elEditor,"")},appendEditor:function(b,a){this._memoEditor.setContent(a);$j(this._elEditor).show().appendTo(b);this._memoEditor.focus()},hideEditor:function(){$j(this._elEditor).hide()},getContent:function(){return this._memoEditor.getContent()},isExistEditor:function(){return $j(this._elEditor).find(":visible")>0},getEditorElement:function(){return this._elEditor},focus:function(){this._memoEditor.focus()},setHeight:function(a){},showToolbar:function(){this._memoEditor.showToolbar()},hideToolbar:function(){this._memoEditor.hideToolbar()}};memo.ContentEditorHistory=$Class({_MAX_SIZE:6,_RECORD_TIME:3*60*1000,$init:function(){this._loadComponent();this._aHistory=[]},_loadComponent:function(){this._oTimer=new jindo.Timer();this._oLayer=new memo.ContentEditorHistoryLayer().attach({select:$Fn(function(b){var c,a=this._aHistory;if(b.bFirst){c=this._oFirst}else{c=a[b.nIndex]}var d=(this._oWaiting||a[a.length-1]);c.memoSeq=d.memoSeq;c.folderId=d.folderId;this.fireEvent("diff",{oMemo:c,sDiff:c.memoContent})},this).bind(),applyDiff:$Fn(function(){this.fireEvent("applyDiff")},this).bind(),cancelDiff:$Fn(function(){this.fireEvent("cancelDiff")},this).bind()})},_add:function(){if(memo.utils.isEmpty(this._oWaiting)){return}var a=this._aHistory,b=memo.utils.clone(this._oWaiting);if(a.length===this._MAX_SIZE){a.shift()}b.modifyDate=$Date().time();a.push(b);this._oWaiting=null},pause:function(){this._oTimer.pause()},resume:function(){this._oTimer.resume()},showLayer:function(b,a){this._add();this._oLayer.show(b,a===true?null:this._aHistory)},hide:function(){this._oLayer.hide()},change:function(a){this._oWaiting=a},start:function(a){this._oFirst=memo.utils.clone(a);delete this._aHistory;this._aHistory=[];delete this._oWaiting;this._oTimer.start($Fn(function(){this._add();return true},this).bind(),this._RECORD_TIME)},stop:function(){this._oTimer.abort()}}).extend(jindo.Component);memo.FunctionBarController=function(a){this._init(a)};memo.FunctionBarController.prototype={_init:function(a){this._jelFunctionBar=$j(a);this._loadComponent();this._attachEvent()},setDependObject:function(a){this._oContentUIController=a.contentUIController;this._oContentListUIController=a.contentListUIController;this._oContentEditorUIController=a.contentEditorUIController},_loadComponent:function(){this._oEditorHistory=new memo.ContentEditorHistory().attach({diff:$Fn(function(b){this._oDiffMemo=b.oMemo;var a=memo.global.currentViewType;if(a==memo.VIEW.MATRIX||a==memo.VIEW.PIN){this._oContentListUIController.showDiff(b.oMemo,b.sDiff)}else{if(a==memo.VIEW.EDITOR){this._oContentEditorUIController.applyUI(b.oMemo,b.sDiff,true)}}},this).bind(),applyDiff:$Fn(function(){var a=memo.global.currentViewType;if(a==memo.VIEW.MATRIX||a==memo.VIEW.PIN){this._oContentListUIController.applyDiff(this._oDiffMemo)}else{if(a==memo.VIEW.EDITOR){this._oContentEditorUIController.applyDiff(this._oDiffMemo)}}this._oDiffMemo=null},this).bind(),cancelDiff:$Fn(function(){this._oDiffMemo=null;this._oEditorHistory.resume();var a=memo.global.currentViewType;if(a==memo.VIEW.MATRIX||a==memo.VIEW.PIN){this._oContentListUIController.hideDiff()}else{if(a==memo.VIEW.EDITOR){this._oContentEditorUIController.hideDiff()}}},this).bind()});this._oDiffMemo=null},_attachEvent:function(){var a=this;this._jelFunctionBar.on("click","._ct_save",function(c){c.preventDefault();var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.saveMemo()}else{if(b==memo.VIEW.EDITOR){a._oContentEditorUIController.saveMemo()}}});this._jelFunctionBar.on("click","._m_cancel",function(c){c.preventDefault();var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.cancelEdit()}else{if(b==memo.VIEW.EDITOR){a._oContentUIController.goToListView()}}});this._jelFunctionBar.on("click","._ct_delete",function(c){c.preventDefault();if(a.isDisabledButton()){return}var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.deleteMemo()}else{if(b==memo.VIEW.EDITOR){a._oContentEditorUIController.deleteMemo()}}});this._jelFunctionBar.on("click","._ct_move",function(c){c.preventDefault();if(a.isDisabledButton()){return}var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.folderMove($j(this)[0])}else{if(b==memo.VIEW.EDITOR){a._oContentEditorUIController.folderMove($j(this)[0])}}});this._jelFunctionBar.on("click","._edt_send",function(b){b.preventDefault();a._oContentEditorUIController.sendToCalendar($j(this)[0])});this._jelFunctionBar.on("click","._memo_type",function(b){b.preventDefault();a._oContentEditorUIController.showMemoTypeLayer($j(this)[0])});this._jelFunctionBar.on("click","._edt_history",function(c){c.preventDefault();var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.showHistoryLayer()}else{if(b==memo.VIEW.EDITOR){a._oContentEditorUIController.showHistoryLayer()}}});this._jelFunctionBar.on("click","._ct_permanent_delete",function(c){c.preventDefault();if(a.isDisabledButton()){return}var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.permanentDelete($j(this)[0])}else{if(b==memo.VIEW.EDITOR){a._oContentEditorUIController.permanentDelete($j(this)[0])}}});this._jelFunctionBar.on("click","._ct_empty_trash",function(b){b.preventDefault();a._oContentListUIController.emptyTrash($j(this)[0])});this._jelFunctionBar.on("click","._ct_all",function(){a._oContentListUIController.selectAllButtonEvent()});$j("#editorToolbar").on("click","._edt_color",function(){var b=memo.global.currentViewType;if(b==memo.VIEW.MATRIX||b==memo.VIEW.PIN){a._oContentListUIController.showColorSelectLayer($j(this)[0])}else{if(b==memo.VIEW.EDITOR){a._oContentEditorUIController.showColorSelectLayer($j(this)[0])}}})},showHideButton:function(a){this._jelFunctionBar.find("._btn").each(function(){if($j(this).attr("data-view-in").indexOf(a)<0){$j(this).hide()}else{$j(this).css("display","")}})},enableFunctionButton:function(a){if(a){this._jelFunctionBar.find("._related_checkbox").removeClass("disable")}else{this._jelFunctionBar.find("._related_checkbox").addClass("disable")}},isDisabledButton:function(a){return $j(a).hasClass("disable")},updateHistory:function(a){this._oEditorHistory.change(a)},startHistory:function(a){this._oEditorHistory.start(a)},showHistoryLayer:function(a){this._oEditorHistory.pause();if(a){this._oEditorHistory.change(a)}var b=this._jelFunctionBar.find("._edt_history");if(b.length){this._oEditorHistory.showLayer(b[0],memo.utils.isNotEmpty(this._oDiffMemo))}},getSelectedDiffMemo:function(){return this._oDiffMemo},hideLayers:function(){this._oEditorHistory.hide()}};if(!memo){memo={}}memo.AudioPlayer=function(){this.init()};memo.AudioPlayer.prototype={init:function(){this._attachEvent();this.$alert=$j("._alert")},_attachEvent:function(){var a=this;$j("#editorWrapper, ._ct_list").on("click","._memo_audio ._btn_play",function(d){d.preventDefault();d.stopPropagation();var c=$j(this);if(memo.utils.isIE()){a.$alert.find("._alert_message").text("브라우저에서 재생을 지원하지 않습니다. 웨일 등 다른 브라우저를 이용해주세요.");a.$alert.show();setTimeout(function(){a.$alert.hide()},5000);return}var f=c.siblings("audio");var b=f[0];f.on("play",function(){c.closest("._memo_audio").addClass("audio_play");c.find(".blind").text("일시정지")}).on("pause",function(){c.find(".blind").text("재생");c.closest("._memo_audio").removeClass("audio_play")}).on("stop",function(){c.find(".blind").text("재생");c.closest("._memo_audio").removeClass("audio_play")}).on("timeupdate",function(){var g=c.parent().find("._time_bar");var e=(b.currentTime/b.duration)*100;g.css("width",(e>=100?0:e)+"%")}).on("ended",function(){c.find(".blind").text("재생");c.closest("._memo_audio").removeClass("audio_play");b.pause()});if(b.duration>0&&!b.paused){b.pause()}else{b.play()}})}};memo.SkinLayer=$Class({$init:function(a){this.option(a||{});var b=$("skinLayer");this._defineElement(b);this._attachEvent(b);this._loadComponent(b);this._sCurrentSkin=this.option("sSkin")},_defineElement:function(b){var a=$Element(b);this._welBody=a;this._welWrap=$Element("wrap")},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._close",$Fn(function(d){d.stop();this.hide()},this).bind());b.delegate("click","._skin_list",$Fn(function(e){e.stop();var d=$Element(e.element).data("id");if(d!==this._sSelectedSkin){this._welWrap.addClass(d).removeClass(this._sSelectedSkin);this._sSelectedSkin=d;this._select(d)}},this).bind());b.delegate("click","._apply",$Fn(function(d){d.stop();this._apply()},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_loadComponent:function(a){this._oLayerManager=new jindo.LayerManager(a,{sCheckEvent:"mousedown"}).link(a).attach({beforeHide:$Fn(function(){this._cancel()},this).bind(),beforeShow:$Fn(function(){this._select(this._sCurrentSkin);this._sSelectedSkin=this._sCurrentSkin},this).bind(),show:function(){$Element(a).query("a").$value().focus()},hide:$Fn(function(){var c=this._elButton,b=document.activeElement.tagName.toLowerCase();if(b!=="textarea"&&b!=="input"){c.focus()}this._oLayerManager.unlink(c);this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition($("container"),a,{sPosition:"inside-top",sAlign:"center",nTop:55,nLeft:0,bAuto:true})},_apply:function(){var a=this._sSelectedSkin;this._sCurrentSkin=a;memo.ajax.call("/changeSkin.nhn",{oParams:{skinClassName:a},fCallback:$Fn(function(){this.hide()},this).bind()})},_select:function(b){var a=this._welBody;var c=a.query("._skin_list.on");if(c!==null){c.removeClass("on")}a.query("._skin_list[data-id="+b+"]").addClass("on")},_cancel:function(){var b=this._sCurrentSkin;var a=this._sSelectedSkin;if(a!==b){this._welWrap.addClass(b).removeClass(a)}},hide:function(){this._oLayerManager.hide()},show:function(a){$("wrap").scrollTop=0;this._elButton=a;this._oLayerManager.show();this._oLayerPosition.setPosition()}}).extend(jindo.Component);memo.FolderConfigLayer=$Class({$init:function(a){this.option(a||{});var b=$("folderConfig");this._welBody=$Element(b);this._attachEvent(b);this._loadComponent(b)},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._folder_rename",$Fn(function(d){d.stop();this.fireEvent("renameFolder",{nFolderId:this._nFolderId});this.hide()},this).bind());b.delegate("click","._folder_default",$Fn(function(d){d.stop();this.fireEvent("defaultFolder",{nFolderId:this._nFolderId,nColorId:this._nColorId});this.hide()},this).bind());b.delegate("click","._folder_empty",$Fn(function(d){d.stop();this.fireEvent("emptyFolder",{nFolderId:this._nFolderId});this.hide()},this).bind());b.delegate("click","._folder_delete",$Fn(function(d){d.stop();this.fireEvent("deleteFolder",{nFolderId:this._nFolderId});this.hide()},this).bind());b.delegate("click","._color",$Fn(function(d){d.stop();this.fireEvent("changeFolderColor",{nFolderId:this._nFolderId,nColorId:$Element(d.element).data("id")});this.hide()},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_loadComponent:function(a){this._oLayerManager=new jindo.LayerManager(a,{sCheckEvent:"mousedown"}).link(a).attach({show:function(){$Element(a).query("a").$value().focus()},hide:$Fn(function(){var c=this._elButton,b=document.activeElement.tagName.toLowerCase();if(b!=="textarea"&&b!=="input"){if($Element(c).visible()){c.focus()}}this._oLayerManager.unlink(c);this._elButton=null},this).bind()});this._oLayerInsideTopPosition=new jindo.LayerPosition(null,a,{sPosition:"inside-top-left",nTop:0,nLeft:0,bActivateOnload:false,bAuto:true});this._oLayerOutsideBottomPosition=new jindo.LayerPosition(null,a,{sPosition:"outside-bottom",sAlign:"left",nTop:0,nLeft:0,bActivateOnload:false,bAuto:true})},hide:function(){this._oLayerManager.hide()},show:function(e,c,f,d,b){this._elButton=e;this._nFolderId=c;this._nColorId=f;if(d){$ElementList(this._welBody.queryAll("._not_default")).hide()}else{$ElementList(this._welBody.queryAll("._not_default")).show()}this._oLayerManager.show();var a=null;if(b){a=this._oLayerOutsideBottomPosition}else{a=this._oLayerInsideTopPosition}a.setElement(e);a.setPosition()}}).extend(jindo.Component);memo.SortOrderLayer=$Class({$init:function(a){this.option(a||{});var b=$("sortOrderLayer");this._defineElement(b);this._attachEvent(b);this._loadComponent(b)},_defineElement:function(b){var a=$Element(b);this._welBody=a},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._sort",$Fn(function(e){e.stop();var d=$Element(e.element);this.fireEvent("select",{sTarget:d.data("target"),sDirection:d.data("direction")});this.hide()},this).bind());b.delegate("mouseenter","._sort",function(d){$Element(d.element).addClass("on")});b.delegate("mouseleave","._sort",function(d){$Element(d.element).removeClass("on")});var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_loadComponent:function(a){this._oLayerManager=new jindo.LayerManager(a,{sCheckEvent:"mousedown"}).link(a).attach({show:function(){$Element(a).query("a").$value().focus()},hide:$Fn(function(){var c=this._elButton,b=document.activeElement.tagName.toLowerCase();if(b!=="textarea"&&b!=="input"){c.focus()}this._oLayerManager.unlink(c);this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition(null,a,{sPosition:"outside-bottom",sAlign:"left",nTop:0,nLeft:-10,bPositionOnload:false})},hide:function(){this._oLayerManager.hide()},show:function(b){if(b===this._elButton){this.hide();return}this._elButton=b;var c=this._oLayerManager;c.show();c.link(b);var a=this._oLayerPosition;a.setElement(b);a.setPosition()}}).extend(jindo.Component);memo.ColorLayer=$Class({$init:function(a){this.option(a||{});var b=$("colorLayer");this._defineElement(b);this._attachEvent(b)},_defineElement:function(b){var a=$Element(b);this._welBody=a},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._edt_color_item",$Fn(function(d){d.stop();var e=$Element(d.element).data("id")*1;this.fireEvent("select",{nColorId:e});this.hide()},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},hide:function(){if(this._elButton){$Element(this._elButton).parent().removeClass("open")}},show:function(c,a){this._elButton=c;var b=$Element(c);if(b.parent().hasClass("open")){b.parent().removeClass("open")}else{b.parent().addClass("open")}}}).extend(jindo.Component);memo.FolderSelectionLayer=$Class({_TPL_LAYER:'<div class="edt_layer" style="display:none"><div class="ly_list_editor" style="width:143px;"><div class="list_scroll"><ul class="_edt_folder_list"></ul></div></div></div>',_TPL_FOLDER:$Template('<li class="color{=nColorId}{if nSelectedFolderId==nFolderId} on{/if}"><a href="#" class="_edt_folder_item" data-id="{=nFolderId}" data-colorid="{=nColorId}" data-name="{=sFolderName}"><span class="folder"></span>{=sFolderName}{if nFolderType==1} (기본){/if}</a></li>'),$init:function(a){this.option(a||{});var b=$(this._TPL_LAYER);this._defineElement(b);this._attachEvent(b);this._loadComponent(b)},_defineElement:function(b){var a=this._welBody=$Element(b);this._welList=a.query("._edt_folder_list")},_attachEvent:function(a){this._welList.delegate("click","._edt_folder_item",$Fn(function(c){clickcr(this,memo.global.bInTrash?"trh*f.folder":memo.nclicksHelper.findAreaCodeInContent()+"*f.folder","","",c.pos());c.stop();var b=$Element(c.element);this.fireEvent("select",{nFolderId:b.data("id")*1,sFolderName:b.data("name"),nColorId:b.data("colorid")*1});this.hide()},this).bind())},_attachAccessibilityEvent:function(b,a){$Element(b).attach("keydown",$Fn(function(c){var d=c.key();if(d.keyCode===9&&d.shift){c.stop();this.hide()}},this).bind());$Element(a).attach("keydown",$Fn(function(c){var d=c.key();if(d.keyCode===9){c.stop();this.hide()}},this).bind())},_loadComponent:function(b){var a=this._oLayerManager=new jindo.LayerManager(b,{sCheckEvent:"mousedown"}).link(b).attach({show:function(){$Element(b).query("a").$value().focus()},hide:$Fn(function(){var d=this._elButton,c=document.activeElement.tagName.toLowerCase();if(c!=="textarea"&&c!=="input"){try{d.focus()}catch(f){window.doNothing=f}}this._oLayerManager.unlink(d);this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition(null,b,{sPosition:"outside-bottom",sAlign:"left",nTop:0,nLeft:0,bPositionOnload:false})},hide:function(){this._oLayerManager.hide()},show:function(b,a){if(b===this._elButton){this.hide();return}memo.ajax.call("/folder/folderList.nhn",{fCallback:$Fn(function(e){var c=[];$A(e.folderList).forEach(function(h){c.push(this._TPL_FOLDER.process({nSelectedFolderId:a,nFolderId:h.folderId,sFolderName:$S(h.folderName).escapeHTML().toString(),nFolderType:h.folderType,nColorId:h.colorId}))},this);var g=this._welList;g.html(c.join(""));this._attachAccessibilityEvent(g.first().query("a").$value(),g.last().query("a").$value());this._elButton=b;var f=this._oLayerManager;f.show();f.link(b);var d=this._oLayerPosition;d.setElement(b);d.setPosition()},this).bind()})}}).extend(jindo.Component);memo.MemoSendLayer=$Class({$init:function(a){this.option(a||{});var b=$("memoSendLayer");this._defineElement(b);this._loadComponent(b);this._attachEvent(b)},_defineElement:function(b){var a=$Element(b);this._welBody=a},_loadComponent:function(a){this._oLayerManager=new jindo.LayerManager(a,{sCheckEvent:"mousedown"}).link(a).attach({show:function(){$Element(a).query("a").$value().focus()},hide:$Fn(function(){var c=this._elButton;if(c){var b=document.activeElement.tagName.toLowerCase();if(b!=="textarea"&&b!=="input"){c.focus()}this._oLayerManager.unlink(c)}this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition(null,a,{sPosition:"outside-bottom",sAlign:"left",nTop:0,nLeft:-10,bPositionOnload:false});this._oCalendarConfirmLayer=memo.CalendarConfirmLayer.prototype.getInstance()},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._send_calendar",$Fn(function(d){d.stop();var f=this._htParams,e=f.sViewType;switch(e){case memo.VIEW.MATRIX:clickcr(d.element,"gdv*l.todo","","");break;case memo.VIEW.PIN:clickcr(d.element,"pnv*l.todo","","");break;default:clickcr(d.element,"mem*l.todo","","");break}this._sendCalendar(f)},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_sendCalendar:function(a){memo.ajax.call("/calendarAPI/createCalendarTodo.nhn",{oParams:{memoSeq:a.nMemoSeq,memoContents:a.sMemoPlainContent,important:a.bImportant},fCallback:$Fn(function(c){var b=this._elButton;this._oCalendarConfirmLayer.show(b,c);this._oLayerManager.unlink(b);this._elButton=null;this.hide()},this).bind()})},hide:function(){this._oLayerManager.hide()},show:function(b,d){if(b===this._elButton){this.hide();return}this._htParams=d;this._elButton=b;var c=this._oLayerManager;c.show();c.link(b);var a=this._oLayerPosition;a.setElement(b);a.setPosition()},getInstance:function(){var a=memo.MemoSendLayer.prototype;if(memo.utils.isEmpty(a.instance)){return(a.instance=new memo.MemoSendLayer())}else{return a.instance}}}).extend(jindo.Component);memo.CalendarConfirmLayer=$Class({$init:function(a){this.option(a||{});var b=$("calendarConfirmLayer");this._defineElement(b);this._attachEvent(b);this._loadComponent(b)},_defineElement:function(b){var a=$Element(b);this._welBody=a},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._close",$Fn(function(d){d.stop();this.hide()},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_loadComponent:function(a){this._oLayerManager=new jindo.LayerManager(a,{sCheckEvent:"mousedown"}).link(a).attach({show:function(){$Element(a).query("a").$value().focus()},hide:$Fn(function(){var c=this._elButton,b=document.activeElement.tagName.toLowerCase();if(b!=="textarea"&&b!=="input"){c.focus()}this._oLayerManager.unlink(c);this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition(document.body,a,{sPosition:"inside-center",bPositionOnload:false})},hide:function(){this._oLayerManager.hide()},show:function(a,c){if(a===this._elButton){this.hide();return}this._welBody.query("._link").attr("href",c);this._elButton=a;var b=this._oLayerManager;b.show();b.link(a);this._oLayerPosition.setPosition()},getInstance:function(){var a=memo.CalendarConfirmLayer.prototype;if(memo.utils.isEmpty(a.instance)){return(a.instance=new memo.CalendarConfirmLayer())}else{return a.instance}}}).extend(jindo.Component);memo.PhotoViewer=$Class({$init:function(a){this.option(a||{});var b=$("photoViewer");this._defineElement(b);this._attachEvent(b);this._loadComponent(b)},_defineElement:function(b){var a=$Element(b);this._welBody=a;this._welImage=a.query("._pht_img");this._welPrev=a.query("._pht_prev");this._welNext=a.query("._pht_next")},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._pht_close",$Fn(function(d){d.stop();clickcr(this,memo.nclicksHelper.findAreaCodeInContent()+"*p.close","","",event);this.hide()},this).bind());this._welPrev.attach("click",$Fn(function(d){d.stop();clickcr(d.element,memo.nclicksHelper.findAreaCodeInContent()+ +"*p.prev","","",d.pos());this._view(this._nIndex-1)},this).bind());this._welNext.attach("click",$Fn(function(d){d.stop();clickcr(d.element,memo.nclicksHelper.findAreaCodeInContent()+ +"*p.next","","",d.pos());this._view(this._nIndex+1)},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_loadComponent:function(b){var a=this._oLayerManager=new jindo.LayerManager(b,{sCheckEvent:"click"}).attach({show:function(){try{$Element(b).query("a").$value().focus()}catch(c){}},hide:$Fn(function(){var d=this._elButton,c=document.activeElement.tagName.toLowerCase();if(c!=="textarea"&&c!=="input"){d.focus()}this._oLayerManager.unlink(d);this._elButton=null},this).bind()});if($Agent().navigator().firefox){a.link(this._welImage.$value())}},_view:function(a){var c=this._aImages,b=c.length;a=a%b;if(a<0){a=b+a}this._nIndex=a;this._welImage.attr("src",c[a])},hide:function(){this._welImage.attr("src","");this._oLayerManager.hide()},_load:function(c,d){this._aImages=c;this._view(d);var a=this._welNext,b=this._welPrev;if(this._aImages.length>1){a.show();b.show()}else{a.hide();b.hide()}this._oLayerManager.show()},show:function(a,b,c){if(a===this._elButton){this.hide();return}this._elButton=a;this._oLayerManager.link(a);this._load(b,c)}}).extend(jindo.Component);memo.ContentEditorHistoryLayer=$Class({_TPL_ITEM:$Template('<li class="_item date{=sExtraClass}" data-index="{=nIndex}"><a href="#"><span class="bg"></span>{=sTime}</a></li>'),$init:function(a){this.option(a||{});var b=$("editorHistoryLayer");this._defineElement(b);this._attachEvent(b);this._loadComponent(b)},_defineElement:function(b){var a=this._welBody=$Element(b);this._welList=a.query("._list");this._welAppy=a.query("._apply");this._welCancel=a.query("._cancel")},_attachEvent:function(a){this._welList.delegate("click","._item",$Fn(function(c){c.stop();var b=$Element(c.element);clickcr(c.element,memo.nclicksHelper.findAreaCodeInToolbar()+"*u.click","","",c.pos());if(b.hasClass("on")){return}this._welList.query("._item.on").removeClass("on");b.addClass("on");this._welAppy.removeClass("disabled");this._welCancel.removeClass("disabled");this.fireEvent("select",{nIndex:b.data("index")*1,bFirst:b.hasClass("_first"),bLast:b.hasClass("_last")})},this).bind());this._welAppy.attach("click",$Fn(function(b){b.stop();if($Element(b.element).hasClass("disabled")){return}this.fireEvent("applyDiff");this.hide()},this).bind());this._welCancel.attach("click",$Fn(function(b){b.stop();if($Element(b.element).hasClass("disabled")){return}this.fireEvent("cancelDiff");this.hide()},this).bind())},_attachAccessibilityEvent:function(b,a){$Element(b).attach("keydown",$Fn(function(c){var d=c.key();if(d.keyCode===9&&d.shift){c.stop();this.hide()}},this).bind());$Element(a).attach("keydown",$Fn(function(c){var d=c.key();if(d.keyCode===9){c.stop();this.hide()}},this).bind())},_loadComponent:function(b){var a=this._oLayerManager=new jindo.LayerManager(b,{sCheckEvent:"mousedown"}).link(b).attach({show:function(){$Element(b).query("a").$value().focus()},hide:$Fn(function(){var d=this._elButton,c=document.activeElement.tagName.toLowerCase();if(c!=="textarea"&&c!=="input"){d.focus()}this._oLayerManager.unlink(d);this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition(null,b,{sPosition:"outside-bottom",sAlign:"left",nTop:0,nLeft:0,bPositionOnload:false,bAuto:true})},_printHistory:function(c){var a=[];var b=c.length;$A(c).forEach(function(e,d){a[b-d-1]=this._TPL_ITEM.process({nIndex:d,sTime:$Date(e.modifyDate).format("H:i"),sExtraClass:""})},this);a.push(this._TPL_ITEM.process({nIndex:-1,sTime:"처음으로",sExtraClass:" _first"}));this._welAppy.addClass("disabled");this._welCancel.addClass("disabled");this._welList.html(a.join("")).first().addClass("on")},hide:function(){this._oLayerManager.hide()},show:function(a,b){if(a===this._elButton){this.hide();return}this._elButton=a;if(b){this._printHistory(b)}this._oLayerManager.show();this._oLayerPosition.setElement(a).setPosition()}}).extend(jindo.Component);memo.InfoLayer=$Class({_LAYER_MARKUP:'<div class="info_layer _layer" style="width:{=nWidth}px;top:400px;left:250px;display:block" data-key="{=sKey}"><div class="wrap"><span class="bu"></span>{=sInfo}<a href="#" class="cls _close"><span class="blind">닫기</span></a></div></div>',$init:function(a){this.option(a||{});this._aLayer=[]},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._close",$Fn(function(h){h.stop();var d=memo.utils.findParentByClass(h.element,"_layer");this.fireEvent("close",{sKey:d.data("key")});d.leave();var g=document.activeElement;if(g){var f=g.tagName.toLowerCase();if(f!=="textarea"&&f!=="input"){try{this._elButton.focus()}catch(i){}}}this._elButton=null},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},_applyInfo:function(e,b,a,c,f){var d=$($Template(this._LAYER_MARKUP).process({sKey:e,sInfo:b,nWidth:a}));this._attachEvent(d);new jindo.LayerPosition(c,d,f);this._aLayer.push(d)},hideAll:function(){$ElementList(this._aLayer).hide()},show:function(a){this._elButton=a.elButton;this._applyInfo(a.sKey,a.sInfo,a.nWidth,a.elButton,a.oPosition)}}).extend(jindo.Component);if(typeof memo=="undefined"){memo={}}memo.PromotionLayer=$Class({$init:function(a){this._ROLLING_INDEX=0;this._PROMOTION_ID="_memo_s2v_pr_again";this._defineElement(a);this._attachEvent()},_defineElement:function(a){this._elPromoLayer=$Element(a);this._elChkPromoAgain=$Element("prapp_nvagain");this._elPromoImage=this._elPromoLayer.query("._ulPromoImage");this._aElPromoImages=this._elPromoLayer.queryAll("._promoImage");this._elRollingPaging=this._elPromoLayer.query("._rolling_paging");this._prevBtn=this._elPromoLayer.query("._prevBtn");this._nextBtn=this._elPromoLayer.query("._nextBtn")},_attachEvent:function(){this._elPromoLayer.delegate("click",".btn_close",$Fn(function(a){a.stop();this._close()},this).bind());this._elPromoLayer.delegate("click","._closeWithPromoSkip",$Fn(function(a){a.stop();this._setSkipPromo();this._close()},this).bind());this._elPromoLayer.delegate("click","._go_link",$Fn(function(a){a.stop();window.open($Element(a.element).data("url"),"_blank")},this).bind());this._elPromoLayer.delegate("click","._open_notice",$Fn(function(a){a.stop();window.open($Element(a.element).data("url"),"nBoardPopup","width=563,height=622")},this).bind());if(this._elRollingPaging){this._elRollingPaging.delegate("click","li",$Fn(function(b){b.stop();var a=this._ROLLING_INDEX=this._elRollingPaging.indexOf($Element(b.delegatedElement));this._slide(a)},this).bind())}if(this._prevBtn){this._prevBtn.attach("click",$Fn(function(a){a.stop();this._slide(--this._ROLLING_INDEX)},this).bind())}if(this._nextBtn){this._nextBtn.attach("click",$Fn(function(a){a.stop();this._slide(++this._ROLLING_INDEX)},this).bind())}},_initialize:function(){var a=memo.utils.getUserInfo();if("no"!==$Cookie().get(a.sUserId+this._PROMOTION_ID)){this._open()}},_slide:function(b){var a=this._aElPromoImages.length-1;if(b==0){this._prevBtn.hide();this._nextBtn.show()}else{if(b==a){this._nextBtn.hide();this._prevBtn.show()}else{this._nextBtn.show();this._prevBtn.show()}}this._elPromoImage.css("left",-590*b);$A(this._elRollingPaging._element.children).forEach(function(c,d){if(b==d){$Element(c).addClass("on")}else{$Element(c).removeClass("on")}})},_open:function(){this._elPromoLayer.show()},_close:function(){if(this._elChkPromoAgain&&this._elChkPromoAgain._element.checked===true){this._setSkipPromo()}this._elPromoLayer.hide()},_setSkipPromo:function(){var a=memo.utils.getUserInfo();$Cookie().set(a.sUserId+this._PROMOTION_ID,"no",120)}});memo.MemoTypeLayer=$Class({$init:function(a){this.option(a||{});var b=$("editorMemoTypeLayer");this._defineElement(b);this._loadComponent(b);this._attachEvent(b)},_defineElement:function(b){var a=$Element(b);this._welBody=a},_loadComponent:function(a){this._oLayerManager=new jindo.LayerManager(a,{sCheckEvent:"mousedown"}).link(a).attach({show:function(){$Element(a).query("a").$value().focus()},hide:$Fn(function(){var c=this._elButton;if(c){var b=document.activeElement.tagName.toLowerCase();if(b!=="textarea"&&b!=="input"){c.focus()}this._oLayerManager.unlink(c)}this._elButton=null},this).bind()});this._oLayerPosition=new jindo.LayerPosition(null,a,{sPosition:"outside-bottom",sAlign:"left",nTop:0,nLeft:-10,bPositionOnload:false})},_attachEvent:function(c){var b=$Element(c);b.delegate("click","._memo_type",$Fn(function(e){e.stop();var d=$Element(e.element);if(d.hasClass("selected")){return}this.fireEvent("setMemoType",{memoType:d.attr("data-type")});$ElementList(b.queryAll("._memo_type")).removeClass("selected");d.addClass("selected");this.hide()},this).bind());var a=b.queryAll("a");if(a.length>0){a[0].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9&&e.shift){d.stop();this.hide()}},this).bind());a[a.length-1].attach("keydown",$Fn(function(d){var e=d.key();if(e.keyCode===9){d.stop();this.hide()}},this).bind())}},hide:function(){this._oLayerManager.hide()},show:function(b,d){if(b===this._elButton){this.hide();return}this._htParams=d;this._elButton=b;var c=this._oLayerManager;c.show();c.link(b);var a=this._oLayerPosition;a.setElement(b);a.setPosition()},setMemoTypeUI:function(b){if(!b){b="BASIC"}var a=this._welBody.queryAll("li._memo_type");$A(a).forEach(function(c){if(c.attr("data-type")==b){c.addClass("selected")}else{c.removeClass("selected")}})}}).extend(jindo.Component);function setNoticeTitle(a){var b=$Element(a).queryAll("ul > li > a > span");$A(b).forEach(function(d,c){$Element($("notice_"+c)).html(cutStringByPixel(d.text(),250,"...",false))},this)}function cutStringByPixel(e,a,f,d){if(!e){return false}if(!f){f="..."}var b=[];if(!this.welMeasure){this.welMeasure=$Element("<span>");this.welMeasure.css({position:"absolute",top:"-1000px",left:"-1000px"});this.welMeasure.appendTo(document.body)}else{this.welMeasure.empty()}e=String(e).replace(/\r?\n/gim," ");if(d){this.welMeasure.css({fontWeight:"bold"})}else{this.welMeasure.css({fontWeight:"normal"})}for(var c=0;c<e.length;c++){if(e.charAt(c)==" "){b.push("&nbsp;")}else{b.push(e.charAt(c))}this.welMeasure.html(b.join("")+f);if(this.welMeasure.width()>a){b.length=b.length-1;return b.join("")+f}}return e}function resizeAll(){var e=$Element("footer");var d=$Element("header");var a=$Element("content");var f=30;var g=$Document(document).clientSize();var b=g.height-(e.height()+d.height());var c=640;if(b<=c){b=c}a.height(b)}function showMobilePopup(a){var b=Math.floor(Math.random()*10+1)%2;if(b==1){window.open("http://mobile.naver.com/service/popup_iphone.nhn?url="+a+"","myWindow","status = 1, height = 645, width = 375, resizable = 0, scrollbars=no")}else{if(b==0){window.open("http://mobile.naver.com/service/popup_galaxyS.nhn?url="+a+"","myWindow","status = 1, height = 645, width = 375, resizable = 0, scrollbars=no")}}};if(typeof memo=="undefined"){memo={}}memo.memoIndexMainBannerRolling=$Class({_nRollingCount:0,_BUTTON_MARKUP:'<button type="button" class="_page" data-index="{=nIndex}"><span class="blind">배너보기</span></button>',_NEXT_VIEW_VALUE:1,_PREV_VIEW_VALUE:-1,$init:function(d){var b=$Element(d).query("._rolling").$value();var f=this._elPagingArea=$Element(d).query("._rolling_paging").$value();this._attachEvent(d,f);var c=this._oRolling=this._loadRollingComponent(b);var e=this._nRollingViewCount=c.getItems().length/2;this._printPaging(this._elPagingArea,e);c.getTransition().pause();var a=Math.floor(Math.random()*e);c.moveTo(a);this._renderPaging(a);c.getTransition().fps(50)},_attachEvent:function(a,c){var b=$Element(a);b.query("._btn_prev").attach("click",$Fn(this._moveRolling,this).bind(this._PREV_VIEW_VALUE));b.query("._btn_next").attach("click",$Fn(this._moveRolling,this).bind(this._NEXT_VIEW_VALUE));$Element(c).delegate("click","._page",$Fn(this._clickPaging,this).bind())},_loadRollingComponent:function(a){return new jindo.CircularRolling(a,{nFPS:0,nDuration:300,sDirection:"horizontal",fEffect:jindo.Effect.linear})},_printPaging:function(d,c){var b;var a=[];for(b=0;b<c;b++){a.push($Template(this._BUTTON_MARKUP).process({nIndex:b}))}$Element(d).html(a.join(" "))},_moveRolling:function(a,c){c.stop();if(this._oRolling.isMoving()){return}var b=this._oRolling;b.moveBy(a);this._renderPaging(b.getIndex()%this._nRollingViewCount)},_clickPaging:function(b){b.stop();var a=$Element(b.element).attr("data-index")*1;this._oRolling.moveTo(a);this._renderPaging(a)},_renderPaging:function(b){var a=$Element(this._elPagingArea);$A(a.queryAll("._page")).forEach(function(d,c){if(c==b){d.addClass("on")}else{d.removeClass("on")}})}});if(typeof memo=="undefined"){memo={}}memo.memoIndexMainSayRolling=$Class({_commentList:["폰에서도, PC에서도 네이버 메모만 있다면 언제나 기록할 수 있어요.","직장인이라면 필수! 일하면서 PC에서 쓰고 이동할 땐 폰으로 찾아보고!","폰은 새로 바꿔도 네이버 메모앱 덕분에 내 메모들은 그대로~","중요한 건 볼드에 형광펜으로 강조 팍팍!","오늘 할 일을 체크박스로 적고 알림으로 관리하니 잊어버리지 않아요!","귀찮을 땐 음성으로 간편하게 남길 수 있어 편해요.","예쁜 옷 사진 첨부하고 쇼핑몰 이름도 같이 메모하니 나중에 찾기 편해요.","디자인 수정 사항은 이미지에 바로 표시할 수 있어 그리기 툴이 유용해요!","오늘 장보기 리스트를 위젯으로 꺼내놓고 퇴근길에 홈화면에서 바로 봐요.","수정하고 아차싶을 땐 되돌리기 기능이 있어 마음껏 수정할 수 있어요.",'등굣길에 본 재미있는 뉴스,"보내기 메모" 버튼만 꾸욱 누르면 바로 스크랩!'],_MEMO_SAY_MARKUP:'<li><em class="ic">코멘트</em><span  style="letter-spacing:-1px;padding-right:15px;">"{=sMessage}"</span></li>',_NEXT_SAY_VALUE:1,_PREV_SAY_VALUE:-1,$init:function(a){this._elCommentRolling=$Element(a).query("._comment_lst").$value();this._renderPage();this._oRolling=this._initRolling();this._attachEvent(a);this._activeAutoRolling(this._oRolling,this._NEXT_SAY_VALUE)},_attachEvent:function(a){var b=$Element(a);b.query("._btn_prev_say").attach("click",$Fn(this._moveRolling,this).bind(this._PREV_SAY_VALUE));b.query("._btn_next_say").attach("click",$Fn(this._moveRolling,this).bind(this._NEXT_SAY_VALUE))},_renderPage:function(){var b;var a=[];for(b=0;b<this._commentList.length;b++){a.push($Template(this._MEMO_SAY_MARKUP).process({sMessage:this._commentList[b]}))}$Element(this._elCommentRolling).html("<ul>"+a.join(" ")+"</ul>")},_initRolling:function(){return new jindo.CircularRolling(this._elCommentRolling,{nFPS:50,nDuration:200,sDirection:"vertical",fEffect:jindo.Effect.linear})},_moveRolling:function(a){if(this._oRolling.isMoving()){return}var b=this._oRolling;b.moveBy(a)},_activeAutoRolling:function(c,b){var a=new jindo.Timer();a.start(function(){c.moveBy(b);return true},3000)}});